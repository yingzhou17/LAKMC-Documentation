<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LKMC.Results &mdash; LKMC 150623-1236-g1254817 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '150623-1236-g1254817',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="LKMC 150623-1236-g1254817 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LKMC 150623-1236-g1254817 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for LKMC.Results</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Results module.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Utilities</span>
<span class="kn">from</span> <span class="nn">.Utilities</span> <span class="k">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Writer</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Rates</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Filtering</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Defects</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">ClientServerInterface</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Prefactor</span>

<span class="c1">################################################################################</span>


<div class="viewcode-block" id="KMCStepResults"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults">[docs]</a><span class="k">class</span> <span class="nc">KMCStepResults</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Results object.</span>
<span class="sd">    Holds results from a single KMC step.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputDirectory</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">statusObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">KMCStep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initialState</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">refState</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ratesListLock</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ratesListProxy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># status object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusObj</span> <span class="o">=</span> <span class="n">statusObj</span>

        <span class="c1"># initial state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialState</span> <span class="o">=</span> <span class="n">initialState</span>

        <span class="c1"># ref state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refState</span> <span class="o">=</span> <span class="n">refState</span>

        <span class="c1"># KMC step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">KMCStep</span> <span class="o">=</span> <span class="n">KMCStep</span>

        <span class="c1"># Roulette file</span>
        <span class="k">if</span> <span class="n">KMCStep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rouletteFile</span> <span class="o">=</span> <span class="s2">&quot;Roulette.OUT&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rouletteFile</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># dictionary to store results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reverseBarriers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;timing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;externals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;prefactors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volIndxs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barrierOrigin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reuseInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;debugSadSearch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;searchTimingAll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;searchTimingSuccess&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;searchTimingFailure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># failed reasons for searches</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">searchFailedReasons</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iniEVSumOfLogs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># store parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">useBasin</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeHashkey&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeCOM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;transIndex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalCOM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalMoment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinNum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># volume index in the final</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalDVIndex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oldState</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">barrCompareSaddles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;saddles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># output dir for this task</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span> <span class="o">=</span> <span class="n">outputDirectory</span>

        <span class="c1"># writer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">writer</span>

        <span class="c1"># counters for volumes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NCompleted</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessful</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NStored</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># checks for the initial eigenvalues calculations on volumes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFinish</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFail</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unfinishedRateCalculations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># overall counters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessfulTot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NCompletedTot</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentIDs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># total rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalRate</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span> <span class="o">=</span> <span class="n">ratesListLock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span> <span class="o">=</span> <span class="n">ratesListProxy</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span><span class="o">.</span><span class="n">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="c1"># transition volumes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># number of items to stop at (for searches, ie when not a fixed number of inputs)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumeNItemsDict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># number of fixed barrier refinements done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixedRefineNum</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># debugging server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NJobsByRank</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rankWorkingTime</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># init time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># debug rates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumeTotalRate</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumeRateChange</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalRateChange</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">]</span>

<div class="viewcode-block" id="KMCStepResults.addIniEigenValCalcs"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.addIniEigenValCalcs">[docs]</a>    <span class="k">def</span> <span class="nf">addIniEigenValCalcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">volumesList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds initial eigenvalue calculation jobs to the dictionaries.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">Prefactor</span><span class="o">.</span><span class="n">iniEVCalcjobName</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">volumeNItemsDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">volumesList</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NCompleted</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessful</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentIDs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFinish</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFail</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="n">volumesList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFinish</span><span class="p">[</span><span class="n">vol</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFail</span><span class="p">[</span><span class="n">vol</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="KMCStepResults.modifyVolumeNItems"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.modifyVolumeNItems">[docs]</a>    <span class="k">def</span> <span class="nf">modifyVolumeNItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volumeIndex</span><span class="p">,</span> <span class="n">addToNItems</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the given number of searches to the volume</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if not volumeIndex in self.volumeNItemsDict:</span>
        <span class="c1">#     print self.volumeNItemsDict.keys()</span>
        <span class="c1">#     log(__name__, &quot;Error: volume %r not already in dict; cannot modify NItems&quot; % volumeIndex, 0, 0)</span>
        <span class="c1">#     return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volumeNItemsDict</span><span class="p">[</span><span class="n">volumeIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="n">addToNItems</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumeNItemsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Error: volume </span><span class="si">%r</span><span class="s2"> not already in dict; cannot modify NItems&quot;</span> <span class="o">%</span> <span class="n">volumeIndex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">[</span><span class="n">volumeIndex</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="KMCStepResults.addVolume"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.addVolume">[docs]</a>    <span class="k">def</span> <span class="nf">addVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">volumeIndex</span><span class="p">,</span> <span class="n">NItems</span><span class="p">,</span> <span class="n">repeat</span><span class="p">,</span> <span class="n">volTransObject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fixedRefineNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add volume.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">volumeIndex</span>

        <span class="k">if</span> <span class="n">volTransObject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">volTransObject</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Defects</span><span class="o">.</span><span class="n">VolumeTransitionsObject</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">volTransObject</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Adding volumes to volTransDict (addVolume)&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;volTransObject&quot;</span><span class="p">,</span>  <span class="n">volTransObject</span>
            <span class="nb">print</span> <span class="s2">&quot;type(volTransObject)&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">volTransObject</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">volumeNItemsDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">NItems</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixedRefineNum</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixedRefineNum</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NCompleted</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessful</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NStored</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">repeat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentIDs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">volumeTotalRate</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumeRateChange</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">]</span></div>

<div class="viewcode-block" id="KMCStepResults.stopVolume"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.stopVolume">[docs]</a>    <span class="k">def</span> <span class="nf">stopVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volumeIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Notify results object that searches on this volume have stopped.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="p">[</span><span class="n">volumeIndex</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="KMCStepResults.processResult"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.processResult">[docs]</a>    <span class="k">def</span> <span class="nf">processResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process result.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ClientServerInterface</span><span class="o">.</span><span class="n">Result</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;WARNING: result must be of type ClientServerInterface.Result not&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="n">result</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">currentVolIndex</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;EMPTYJOB&quot;</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Notified of empty job&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">currentVolIndex</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">jobID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIDs</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: this job is not from this step (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">jobID</span><span class="p">),),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIDs</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">idss</span><span class="p">),),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">currentVolIndex</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">job</span> <span class="o">==</span> <span class="n">Prefactor</span><span class="o">.</span><span class="n">iniEVCalcjobName</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processIniEigenValCalcsResult</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processSearchRefineResult</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stop</span></div>

<div class="viewcode-block" id="KMCStepResults.processIniEigenValCalcsResult"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.processIniEigenValCalcsResult">[docs]</a>    <span class="k">def</span> <span class="nf">processIniEigenValCalcsResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes initial eigenvalue calculation job result</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">volIndex</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">currentVolIndex</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NCompleted</span><span class="p">[</span><span class="n">Prefactor</span><span class="o">.</span><span class="n">iniEVCalcjobName</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFinish</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFail</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Initial EV CALCS: Notified of FAILURE (vol </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">volIndex</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iniEVSumOfLogs</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">initialSumLogEVs</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Initial EV CALCS: Notified of SUCCESS (vol </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">volIndex</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NCompleted</span><span class="p">[</span><span class="n">Prefactor</span><span class="o">.</span><span class="n">iniEVCalcjobName</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeNItemsDict</span><span class="p">[</span><span class="n">Prefactor</span><span class="o">.</span><span class="n">iniEVCalcjobName</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessful</span><span class="p">[</span><span class="n">Prefactor</span><span class="o">.</span><span class="n">iniEVCalcjobName</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Prefactor</span><span class="o">.</span><span class="n">iniEVCalcjobName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">[</span><span class="n">Prefactor</span><span class="o">.</span><span class="n">iniEVCalcjobName</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Prefactor</span><span class="o">.</span><span class="n">iniEVCalcjobName</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stop</span></div>

<div class="viewcode-block" id="KMCStepResults.saveFix"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.saveFix">[docs]</a>    <span class="k">def</span> <span class="nf">saveFix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        store fix to file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">fixIndex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;DUPLICATE&quot;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">outputDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">,</span><span class="s2">&quot;fixResults.csv&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fixIndex</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span></div>

<div class="viewcode-block" id="KMCStepResults.processSearchRefineResult"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.processSearchRefineResult">[docs]</a>    <span class="k">def</span> <span class="nf">processSearchRefineResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes search/refinement job result</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        result : Result object</span>
<span class="sd">            Holds information about an individual transition result</span>
<span class="sd">            - see ClientServerInterface for full list of attributes.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># which volume did this result come from</span>
        <span class="n">currentVolIndex</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">currentVolIndex</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Warning: this volume should have stopped: </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">currentVolIndex</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">jobID</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NCompletedTot</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NCompleted</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saveFix</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># timing / stats</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">runTime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rankWorkingTime</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">rank</span><span class="p">]</span> <span class="o">+=</span> <span class="n">result</span><span class="o">.</span><span class="n">runTime</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rankWorkingTime</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">rank</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">runTime</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJobsByRank</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">rank</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NJobsByRank</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">rank</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># if failed return now</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Notified of failure (vol </span><span class="si">%d</span><span class="s2">) (</span><span class="si">%d</span><span class="s2"> searches completed)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">currentVolIndex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NCompletedTot</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">add</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrDebugSearches</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">failedReason</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">searchFailedReasons</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">failedReason</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">searchFailedReasons</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">failedReason</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Search fail reason: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">failedReason</span><span class="p">,),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessfulTot</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessful</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># is this a duplicate</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;DUPLICATE&quot;</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Notified of duplicate (vol </span><span class="si">%d</span><span class="s2">) (</span><span class="si">%d</span><span class="s2"> searches completed)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">currentVolIndex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NCompletedTot</span><span class="p">,),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">add</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">add</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">_debugOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NCompletedTot</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">add</span><span class="p">,</span> <span class="n">duplIdx</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
            <span class="c1"># apply any filters</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="n">Filtering</span><span class="o">.</span><span class="n">filterResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initialState</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

            <span class="c1"># DEBUG MOVEMENT: this is here temporarily</span>
            <span class="k">if</span> <span class="n">accept</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">refState</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">filterByDefectMovement</span><span class="p">:</span>
<span class="c1">#                print &quot;FILTER BY DEFECT MOVEMENT: are you sure you want to be doing this!?&quot;</span>
                <span class="n">iniCopy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initialState</span><span class="p">)</span>
                <span class="n">finCopy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="p">)</span>

                <span class="n">iniDefects</span> <span class="o">=</span> <span class="n">iniCopy</span><span class="o">.</span><span class="n">findDefects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refState</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">finDefects</span> <span class="o">=</span> <span class="n">finCopy</span><span class="o">.</span><span class="n">findDefects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refState</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="n">foundMoved</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">iniDefects</span><span class="o">.</span><span class="n">NVac</span><span class="p">):</span>
                    <span class="n">iniPos</span> <span class="o">=</span> <span class="n">iniDefects</span><span class="o">.</span><span class="n">vacPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>

                    <span class="n">moved</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">moveDist</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">finDefects</span><span class="o">.</span><span class="n">NVac</span><span class="p">):</span>
                        <span class="n">finPos</span> <span class="o">=</span> <span class="n">finDefects</span><span class="o">.</span><span class="n">vacPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">iniPos</span><span class="p">,</span> <span class="n">finPos</span><span class="p">,</span> <span class="n">iniCopy</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                            <span class="n">moved</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                        <span class="k">elif</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="n">moveDist</span><span class="p">:</span>
                            <span class="n">moveDist</span> <span class="o">=</span> <span class="n">sep</span>

                    <span class="k">if</span> <span class="n">moved</span><span class="p">:</span>
<span class="c1">#                        print &quot;  VAC MOVED&quot;, iniPos, moveDist</span>
                        <span class="n">foundMoved</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">iniDefects</span><span class="o">.</span><span class="n">NInt</span><span class="p">):</span>
                    <span class="n">iniPos</span> <span class="o">=</span> <span class="n">iniDefects</span><span class="o">.</span><span class="n">intPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>

                    <span class="n">moved</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">moveDist</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">finDefects</span><span class="o">.</span><span class="n">NInt</span><span class="p">):</span>
                        <span class="n">finPos</span> <span class="o">=</span> <span class="n">finDefects</span><span class="o">.</span><span class="n">intPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">iniPos</span><span class="p">,</span> <span class="n">finPos</span><span class="p">,</span> <span class="n">iniCopy</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                            <span class="n">moved</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                        <span class="k">elif</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="n">moveDist</span><span class="p">:</span>
                            <span class="n">moveDist</span> <span class="o">=</span> <span class="n">sep</span>

                    <span class="k">if</span> <span class="n">moved</span><span class="p">:</span>
<span class="c1">#                        print &quot;  INT MOVED:&quot;, iniPos, moveDist</span>
                        <span class="n">foundMoved</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">iniDefects</span><span class="o">.</span><span class="n">NAnt</span><span class="p">):</span>
                    <span class="n">iniPos</span> <span class="o">=</span> <span class="n">iniDefects</span><span class="o">.</span><span class="n">antPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>

                    <span class="n">moved</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">moveDist</span> <span class="o">=</span> <span class="mi">9999</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">finDefects</span><span class="o">.</span><span class="n">NAnt</span><span class="p">):</span>
                        <span class="n">finPos</span> <span class="o">=</span> <span class="n">finDefects</span><span class="o">.</span><span class="n">antPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">iniPos</span><span class="p">,</span> <span class="n">finPos</span><span class="p">,</span> <span class="n">iniCopy</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                            <span class="n">moved</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                        <span class="k">elif</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="n">moveDist</span><span class="p">:</span>
                            <span class="n">moveDist</span> <span class="o">=</span> <span class="n">sep</span>

                    <span class="k">if</span> <span class="n">moved</span><span class="p">:</span>
<span class="c1">#                        print &quot;  ANT MOVED:&quot;, iniPos, moveDist</span>
                        <span class="n">foundMoved</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">foundMoved</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Failure: No defects moved&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">searchFailedReasons</span><span class="p">[</span><span class="s2">&quot;Filter: no defects moved&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">searchFailedReasons</span><span class="p">[</span><span class="s2">&quot;Filter: no defects moved&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">accept</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="c1"># END DEBUG MOVEMENT</span>

        <span class="c1"># add the result</span>
        <span class="n">storeVolIndex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">add</span> <span class="ow">and</span> <span class="n">accept</span><span class="p">:</span>
            <span class="n">resultIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span>
            <span class="n">mergeStatus</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># store transition for reuse?</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">storeVolIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Storing transition in different volume than it was found in (</span><span class="si">%d</span><span class="s2"> not </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">storeVolIndex</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

                    <span class="n">storeVolIndex</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">storeVolIndex</span>

                    <span class="k">if</span> <span class="n">storeVolIndex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">:</span>
                        <span class="c1"># merge transition</span>
                        <span class="p">(</span><span class="n">mergeStatus</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">storeVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">mergeTransition</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Warning: cannot merge transition into volume </span><span class="si">%d</span><span class="s2">; no volume file exists (must depend on one running); check you have found all expected transitions&quot;</span> <span class="o">%</span> <span class="n">storeVolIndex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="n">mergeStatus</span> <span class="o">=</span> <span class="mi">5</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">storeVolIndex</span> <span class="o">=</span> <span class="n">currentVolIndex</span>

                    <span class="c1"># index of this transition</span>
                    <span class="n">transIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">storeVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">transitionList</span><span class="p">)</span>

                    <span class="c1"># set the index on the object</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span><span class="o">.</span><span class="n">setTransitionIndex</span><span class="p">(</span><span class="n">transIndex</span><span class="p">)</span>

                    <span class="c1"># add</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">storeVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">addTransitionObject</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span><span class="p">)</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Storing transition in volumeTransitionsDict&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUG: length of volumeTransitionDict: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">storeVolIndex</span><span class="p">])),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;transitionObject is None&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mergeStatus</span><span class="p">:</span>
                <span class="c1"># Error in Dreadnaut or Duplicate to other transitions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addTimeLogToDict</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrDebugTotalRates</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">volumeRateChange</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeRateChange</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">totalRateChange</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalRateChange</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># output result here</span>
                <span class="n">_outputResult</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">resultIndex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialState</span><span class="p">,</span> <span class="n">refState</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">refState</span><span class="p">)</span>

                <span class="c1"># add to dictionaries</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">save2Roulette</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addResultToDict</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">storeVolIndex</span><span class="p">,</span> <span class="n">resultIndex</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">storeVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">transitionList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">finalHashkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUG: add final hashkey (1): </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">storeVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">transitionList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">finalHashkey</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">save2Roulette</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addResultToDict</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="p">,</span> <span class="n">resultIndex</span><span class="p">)</span>
                    <span class="c1"># print &quot;save2Roulette&quot;, save2Roulette</span>
                    <span class="c1"># print &quot;result barriers&quot;, result.barrier, result.reverseBarrier</span>
                    <span class="c1"># print &quot;result.rate&quot;, result.rate</span>
                    <span class="c1"># print &quot;currentVolIndex&quot;, currentVolIndex</span>
                    <span class="c1"># print &quot;self.volumeTransitionsDict:&quot;</span>
                    <span class="c1"># for c in range(len(self.volumeTransitionsDict)):</span>
                    <span class="c1">#     print c, self.volumeTransitionsDict[c]</span>
                    <span class="c1"># print &quot;self.volumeTransitionsDict[currentVolIndex]&quot;, self.volumeTransitionsDict[currentVolIndex]</span>
                    <span class="c1"># print &quot;self.volumeTransitionsDict[currentVolIndex].transitionList[:]\n&quot;, self.volumeTransitionsDict[currentVolIndex].transitionList[:]</span>
                    <span class="c1"># print &quot;self.volumeTransitionsDict[currentVolIndex].transitionList[-1]&quot;, self.volumeTransitionsDict[currentVolIndex].transitionList[-1]</span>
                    <span class="c1"># print &quot;self.volumeTransitionsDict[currentVolIndex].transitionList[-1].finalHashkey&quot;, self.volumeTransitionsDict[currentVolIndex].transitionList[-1].finalHashkey</span>
                    <span class="c1"># print &quot;self.resultsDict[\&quot;finalHashkey\&quot;][:]\n&quot;, self.resultsDict[&quot;finalHashkey&quot;][:]</span>
                    <span class="c1"># print &quot;self.resultsDict[\&quot;finalHashkey\&quot;][-1]&quot;, self.resultsDict[&quot;finalHashkey&quot;][-1]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">transitionList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">finalHashkey</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: final hashkey None in processSearchRefineResult: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">transitionList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">finalHashkey</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                        <span class="c1"># volumeTransitionsDict[currentVolIndex].transitionList[-1].finalHashkey = self.resultsDict[&quot;finalHashkey&quot;][-1]</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUG: add final hashkey (2): </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeTransitionsDict</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">transitionList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">finalHashkey</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: no volumeTransitionsDict entry for currentVolIndex (</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">currentVolIndex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: no finalHashkey entry for currentVolIndex (</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">currentVolIndex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


                <span class="c1"># write to Roulette file</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rouletteFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">save2Roulette</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">writeRouletteEvent</span><span class="p">(</span><span class="n">resultIndex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addTimeLogToDict</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrDebugTotalRates</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">volumeRateChange</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeRateChange</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">totalRateChange</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalRateChange</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># update status</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusObj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;DUPLICATE&quot;</span><span class="p">:</span>
                <span class="n">stat</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span>
                <span class="n">stat</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">add</span> <span class="ow">and</span> <span class="n">accept</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">mergeStatus</span><span class="p">:</span>
                        <span class="n">stat</span> <span class="o">=</span> <span class="mi">3</span>
                    <span class="k">elif</span> <span class="n">mergeStatus</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">stat</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stat</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stat</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">job</span> <span class="o">==</span> <span class="s2">&quot;FIXEDREFINE&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statusObj</span><span class="o">.</span><span class="n">updateSearches</span><span class="p">(</span><span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">storeVolIndex</span><span class="o">=</span><span class="n">storeVolIndex</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NCompleted</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeNItemsDict</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fixedRefineNum</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]):</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">job</span> <span class="o">==</span> <span class="s2">&quot;BARRIERREFINE&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Linked to transition </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">): </span><span class="si">%f</span><span class="s2"> eV&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">linkedTransIndex</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">reuseHashKey</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">linkedBarrier</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

<span class="c1">#        print &quot;COMPLETED %d of %d (stop: %d)&quot; % (self.NCompleted, self.NJobs, stop)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">worker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Result came from: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">worker</span><span class="p">,),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># search timing dict</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">searchTimingDict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># all</span>
            <span class="n">timingDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;searchTimingAll&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">searchTimingDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">timingDict</span><span class="p">:</span>
                    <span class="n">timingDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">timingDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,]</span>

            <span class="c1"># separate out success and failure</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">add</span> <span class="ow">and</span> <span class="n">accept</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;DUPLICATE&quot;</span><span class="p">:</span>
                <span class="c1"># success/duplicate</span>
                <span class="n">timingDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;searchTimingSuccess&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">searchTimingDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">timingDict</span><span class="p">:</span>
                        <span class="n">timingDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">timingDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># success/duplicate</span>
                <span class="n">timingDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;searchTimingFailure&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">searchTimingDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">timingDict</span><span class="p">:</span>
                        <span class="n">timingDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">timingDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,]</span>

        <span class="k">return</span> <span class="n">stop</span></div>


<div class="viewcode-block" id="KMCStepResults.addEventRateToDict"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.addEventRateToDict">[docs]</a>    <span class="k">def</span> <span class="nf">addEventRateToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eventRate</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the deposition rate to the dictionary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span>   <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Adding cascade event to dictionary&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Adding deposition event to dictionary&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">barrier</span> <span class="o">=</span> <span class="n">Rates</span><span class="o">.</span><span class="n">calculateBarrier</span><span class="p">(</span><span class="n">eventRate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">barrier</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reverseBarriers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volIndxs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;prefactors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">fixedPrefactorVal</span><span class="p">)</span>

        <span class="c1"># store depo rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eventRate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalRate</span> <span class="o">+=</span> <span class="n">eventRate</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">eventRate</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Storing event rate: </span><span class="si">%f</span><span class="s2">, with a corresponding barrier of </span><span class="si">%f</span><span class="s2"> eV&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eventRate</span><span class="p">,</span> <span class="n">barrier</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># store final</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span>   <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barrierOrigin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">3.1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barrierOrigin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">3.2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reuseInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="c1">#         self.resultsDict[&quot;timing&quot;].append(None)</span>
<span class="c1">#         self.resultsDict[&quot;debugSadSearch&quot;].append(None)</span>
<span class="c1">#         self.resultsDict[&quot;externals&quot;].append(None)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">useBasin</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;transIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalMoment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinNum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalDVIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrCompareSaddles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;saddles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="KMCStepResults.addTimeLogToDict"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.addTimeLogToDict">[docs]</a>    <span class="k">def</span> <span class="nf">addTimeLogToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="c1"># store time log:</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">timing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;timing&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">timing</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.addSaddSearchToDict"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.addSaddSearchToDict">[docs]</a>    <span class="k">def</span> <span class="nf">addSaddSearchToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="c1"># store time log:</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">sadSearchDebugInfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;debugSadSearch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">sadSearchDebugInfo</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.removeFromDict"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.removeFromDict">[docs]</a>    <span class="k">def</span> <span class="nf">removeFromDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reverseBarriers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalRate</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="c1">#         del self.resultsDict[&quot;timing&quot;][index]</span>
<span class="c1">#         del self.resultsDict[&quot;externals&quot;][index]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barrierOrigin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reuseInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="c1">#         del self.resultsDict[&quot;debugSadSearch&quot;][index]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volIndxs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;prefactors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;transIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalMoment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinNum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalDVIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;saddles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="KMCStepResults.addResultToDict"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.addResultToDict">[docs]</a>    <span class="k">def</span> <span class="nf">addResultToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="p">,</span> <span class="n">resultIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the given result to the dictionary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if trans move to vol which is skipped</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">NStored</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">currentVolIndex</span><span class="p">):</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Warning: transition has moved to another volume </span><span class="si">%d</span><span class="s2"> which is skipped&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">currentVolIndex</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># store debug data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addSaddSearchToDict</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># store time log:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addTimeLogToDict</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">save2Roulette</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># store barrier</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volIndxs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentVolIndex</span><span class="p">)</span>

            <span class="c1"># check if rate was calculated on client (it shouldn&#39;t be!)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">fixedPrefactor</span><span class="p">:</span>
                    <span class="n">volIndex</span> <span class="o">=</span> <span class="n">currentVolIndex</span>

                    <span class="c1"># checking if the initial eigenvalue calculation is finished</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFinish</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFail</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]:</span>
                        <span class="n">rate</span><span class="p">,</span> <span class="n">prefactor</span> <span class="o">=</span> <span class="n">Rates</span><span class="o">.</span><span class="n">calculateRateWithEigenValues</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iniEVSumOfLogs</span><span class="p">[</span><span class="n">volIndex</span><span class="p">],</span>
                                                                             <span class="n">result</span><span class="o">.</span><span class="n">saddleSumLogEVs</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFinish</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFail</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]:</span>
                        <span class="nb">print</span> <span class="s2">&quot;WARNING: initial eigenvalue calculation on volume &quot;</span><span class="p">,</span> <span class="n">volIndex</span><span class="p">,</span>  <span class="s2">&quot; failed. Using default prefactor.&quot;</span>
                        <span class="n">rate</span><span class="p">,</span> <span class="n">prefactor</span> <span class="o">=</span> <span class="n">Rates</span><span class="o">.</span><span class="n">calculateRateWithEigenValues</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">calcPrefactor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                    <span class="c1"># initial eigenvalue calculation has not finished  yet</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rate</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">prefactor</span> <span class="o">=</span> <span class="kc">None</span>

                        <span class="n">unfinishedCalc</span> <span class="o">=</span> <span class="n">Rates</span><span class="o">.</span><span class="n">UnfinishedRateCalculations</span><span class="p">(</span><span class="n">volIndex</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">saddleSumLogEVs</span><span class="p">,</span> <span class="n">resultIndex</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">unfinishedRateCalculations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unfinishedCalc</span><span class="p">)</span>
                        <span class="n">save2Roulette</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rate</span><span class="p">,</span> <span class="n">prefactor</span> <span class="o">=</span> <span class="n">Rates</span><span class="o">.</span><span class="n">calculateRateWithEigenValues</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">calcPrefactor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">rate</span>
                <span class="n">prefactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">fixedPrefactorVal</span>

            <span class="c1"># add rate to dict</span>
            <span class="k">if</span> <span class="n">rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;prefactors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefactor</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">totalRate</span> <span class="o">+=</span> <span class="n">rate</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rate</span>

                    <span class="k">finally</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrDebugTotalRates</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">volumeTotalRate</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rate</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">volumeRateChange</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeTotalRate</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">totalRateChange</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalRate</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;prefactors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Found transition number </span><span class="si">%d</span><span class="s2"> (vol </span><span class="si">%d</span><span class="s2">) (</span><span class="si">%d</span><span class="s2"> searches completed). Barrier is </span><span class="si">%f</span><span class="s2"> eV&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NCompletedTot</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">,),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUG: rate calculation is delayed due to unifinished initial eigenvalues calculation&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">fixedPrefactor</span> <span class="ow">and</span> <span class="n">rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUG: calculated rate: </span><span class="si">%e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rate</span><span class="p">,),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">reverseBarrier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reverseBarriers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">reverseBarrier</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">reverseBarrier</span> <span class="o">&lt;</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">reverseBarrier</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;INFO: small reverse barrier: </span><span class="si">%f</span><span class="s2"> eV&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">reverseBarrier</span><span class="p">,),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUG: reverse barrier: </span><span class="si">%f</span><span class="s2"> eV&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">reverseBarrier</span><span class="p">,),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reverseBarriers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">NSmallMoves</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">NSmallMoves</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;INFO: LOTS OF ATOMS MOVED: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">NSmallMoves</span><span class="p">,),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># store final</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">job</span> <span class="o">==</span> <span class="s2">&quot;BARRIERSEARCH&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barrierOrigin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reuseInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">job</span> <span class="o">==</span> <span class="s2">&quot;BARRIERREFINE&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barrierOrigin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="nb">print</span> <span class="s2">&quot;DEBUGINFO:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">reuseWorkVolId</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">reuseHashKey</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">linkedTransIndex</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reuseInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">reuseWorkVolId</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">reuseHashKey</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">linkedTransIndex</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barrierOrigin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reuseInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># store basin flag &amp; other info</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">useBasin</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinNum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">reverseBarrier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinLowBarrier</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">reverseBarrier</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinLowBarrier</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinSubLowBarrier</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">reverseBarrier</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinSubLowBarrier</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Warning: Reverse barrier is None&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinLowBarrier</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinSubLowBarrier</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrCompareSaddles</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">saddle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;saddles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">saddle</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">countNumIndividualVolumes</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">countNumIndividualVolumes</span><span class="p">()</span>
<span class="c1">#                     if len(result.final.defectVolumesKeys) == len(self.oldState.defectVolumesKeys) and currentVolIndex &lt;= len(result.final.defectVolumesKeys):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">countIndividualVolumes</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">countIndividualVolumes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">countIndividualVolumes</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">countIndividualVolumes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">countIndividualVolumes</span><span class="p">):</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Debug: final DV No. </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">, currentState DV No. </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">, currentVolIndex </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">countIndividualVolumes</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumesKeys</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">countIndividualVolumes</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">defectVolumesKeys</span><span class="p">),</span> <span class="n">currentVolIndex</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

                    <span class="c1"># calculate the min COM difference, find the hashkey of final for the transition</span>
                        <span class="n">minDiff</span> <span class="o">=</span> <span class="mi">1000</span>
                        <span class="n">minNum</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumesKeys</span><span class="p">)):</span>
                            <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">,</span>
                                                      <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">num</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
<span class="c1">#                             print num, diff, self.oldState.defectVolumesKeys[currentVolIndex], result.final.defectVolumesKeys[num]</span>
                            <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">minDiff</span><span class="p">:</span>
                                <span class="n">minDiff</span> <span class="o">=</span> <span class="n">diff</span>
                                <span class="n">minNum</span> <span class="o">=</span> <span class="n">num</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Debug: final COM minDiff </span><span class="si">%f</span><span class="s2">, currentVolIndex </span><span class="si">%d</span><span class="s2">, minNum </span><span class="si">%d</span><span class="s2">, hashkey </span><span class="si">%s</span><span class="s2">, moment [</span><span class="si">%r</span><span class="s2">]&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">minDiff</span><span class="p">,</span><span class="n">currentVolIndex</span><span class="p">,</span> <span class="n">minNum</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumesKeys</span><span class="p">[</span><span class="n">minNum</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">minNum</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">minNum</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">minNum</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalMoment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">minNum</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalDVIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minNum</span><span class="p">)</span>
                    <span class="c1"># when DV number changes...</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalMoment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalDVIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#                         self.resultsDict[&quot;basinFlag&quot;][-1] = 0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalMoment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalDVIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">job</span> <span class="o">==</span> <span class="s2">&quot;BARRIERREFINE&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">reuseHashKey</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;transIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">linkedTransIndex</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">job</span> <span class="o">==</span> <span class="s2">&quot;BARRIERSEARCH&quot;</span><span class="p">:</span>
<span class="c1">#                     print result.transitionObject.hashKey, result.transitionObject.index</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span><span class="o">.</span><span class="n">hashKey</span><span class="p">)</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Debug: Adding transIndex to results dict for new search </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span><span class="o">.</span><span class="n">index</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                        <span class="c1"># numFixRef = len(self.currentState.defectVolumes[currentVolIndex].fixedRefine)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;transIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">)</span>
                    <span class="c1"># for volumes without stored transitions, exit the basin</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;transIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="c1"># raise RuntimeError(&quot;Tried to create a result with no transIndex (1)&quot;)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;transIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="c1"># raise RuntimeError(&quot;Tried to create a result with no transIndex (2)&quot;)</span>

            <span class="c1"># Final hashKey</span>
            <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">countNumIndividualVolumes</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initialState</span><span class="o">.</span><span class="n">countNumIndividualVolumes</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">countIndividualVolumes</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">countIndividualVolumes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialState</span><span class="o">.</span><span class="n">countIndividualVolumes</span><span class="p">:</span>
                    <span class="c1"># calculate the min COM difference, find the hashkey of final for the transition</span>
                    <span class="n">minDiff</span> <span class="o">=</span> <span class="mi">1000</span>
                    <span class="n">minNum</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumesKeys</span><span class="p">)):</span>
                        <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initialState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">,</span>
                                                  <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">num</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialState</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
    <span class="c1">#                             print num, diff, self.initialState.defectVolumesKeys[currentVolIndex], result.final.defectVolumesKeys[num]</span>
                        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">minDiff</span><span class="p">:</span>
                            <span class="n">minDiff</span> <span class="o">=</span> <span class="n">diff</span>
                            <span class="n">minNum</span> <span class="o">=</span> <span class="n">num</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Debug: final COM minDiff </span><span class="si">%f</span><span class="s2">, currentVolIndex </span><span class="si">%d</span><span class="s2">, minNum </span><span class="si">%d</span><span class="s2">, hashkey </span><span class="si">%s</span><span class="s2">, moment [</span><span class="si">%r</span><span class="s2">]&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">minDiff</span><span class="p">,</span><span class="n">currentVolIndex</span><span class="p">,</span> <span class="n">minNum</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumesKeys</span><span class="p">[</span><span class="n">minNum</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">minNum</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">minNum</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">NStored</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">save2Roulette</span></div>

<div class="viewcode-block" id="KMCStepResults.addMergeResultToDict"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.addMergeResultToDict">[docs]</a>    <span class="k">def</span> <span class="nf">addMergeResultToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mergeNum</span><span class="p">,</span> <span class="n">volTransObject</span><span class="p">,</span> <span class="n">currentVolIndexes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add transitions which are merged to the defectVolume (last mergeNum transitions) to the dictionary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">transNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">volTransObject</span><span class="o">.</span><span class="n">transitionList</span><span class="p">)</span><span class="o">-</span><span class="n">mergeNum</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">volTransObject</span><span class="o">.</span><span class="n">transitionList</span><span class="p">)):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">volTransObject</span><span class="o">.</span><span class="n">transitionList</span><span class="p">[</span><span class="n">transNum</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">currentVolIndex</span> <span class="ow">in</span> <span class="n">currentVolIndexes</span><span class="p">:</span>
                <span class="c1"># get rid of the case where vol 2 are waiting for the search results from vol 1 to refine, and reverse trans want to be added to vol 2 as well.</span>
                <span class="c1"># Maybe not the best way, currently should work.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NStored</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Skip appending transition number </span><span class="si">%d</span><span class="s2"> (vol </span><span class="si">%d</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># store barrier</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volIndxs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentVolIndex</span><span class="p">)</span>

                <span class="c1"># currently no prefactor calculation here!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;prefactors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">fixedPrefactorVal</span><span class="p">)</span>

                <span class="c1"># calculate the rate</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="n">Rates</span><span class="o">.</span><span class="n">calculateRate</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">calcPrefactor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">totalRate</span> <span class="o">+=</span> <span class="n">rate</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rate</span>

                    <span class="k">finally</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Append transition number </span><span class="si">%d</span><span class="s2"> (vol </span><span class="si">%d</span><span class="s2">) . Barrier is </span><span class="si">%f</span><span class="s2"> eV&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="p">,</span>  <span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">,),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reverseBarriers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1">#             if result.reverseBarrier is not None:</span>
    <span class="c1">#                 self.resultsDict[&quot;reverseBarriers&quot;].append(result.reverseBarrier)</span>
    <span class="c1">#                 if result.reverseBarrier &lt; 0.1 * result.barrier or result.reverseBarrier &lt; 0.1:</span>
    <span class="c1">#                     log(__name__, &quot;INFO: small reverse barrier: %f eV&quot; % (result.reverseBarrier,), 2, 3)</span>
    <span class="c1">#</span>
    <span class="c1">#                 log(__name__, &quot;DEBUG: reverse barrier: %f eV&quot; % (result.reverseBarrier,), 2, 3)</span>
    <span class="c1">#             else:</span>
    <span class="c1">#                 self.resultsDict[&quot;reverseBarriers&quot;].append(None)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1">#             if result.final is not None:</span>
    <span class="c1">#                 self.resultsDict[&quot;finals&quot;].append(result.final)</span>
    <span class="c1">#             else:</span>
    <span class="c1">#                 self.resultsDict[&quot;finals&quot;].append(None)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barrierOrigin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reuseInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">currentVolIndex</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">hashKey</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">transNum</span><span class="p">))</span>

                <span class="c1"># store basin flag &amp; other info</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">finalHashkey</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">useBasin</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oldState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinNum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinLowBarrier</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;basinFlag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">#                 self.resultsDict[&quot;finalHashkey&quot;].append(result.finalHashkey)</span>
    <span class="c1">#                 self.resultsDict[&quot;finalCOM&quot;].append(None)</span>
    <span class="c1">#                 self.resultsDict[&quot;finalDVIndex&quot;].append(None)</span>
    <span class="c1">#</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volumeHashkey&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">volTransObject</span><span class="o">.</span><span class="n">hashKey</span><span class="p">)</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Debug: Adding transIndex to results dict in mergeResultToDict </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">transitionObject</span><span class="o">.</span><span class="n">index</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;transIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                    <span class="kn">from</span> <span class="nn">.clibs</span> <span class="k">import</span> <span class="n">utilities</span> <span class="k">as</span> <span class="n">c_utils</span>
                    <span class="n">moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="n">centreMass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="n">cellDims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="n">cellDims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refState</span><span class="o">.</span><span class="n">cellDims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cellDims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refState</span><span class="o">.</span><span class="n">cellDims</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">cellDims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refState</span><span class="o">.</span><span class="n">cellDims</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;NVolAtoms&quot;</span><span class="p">):</span>
                        <span class="n">c_utils</span><span class="o">.</span><span class="n">centre_of_mass</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">NVolAtoms</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">finalPos</span><span class="p">,</span> <span class="n">centreMass</span><span class="p">,</span> <span class="n">cellDims</span><span class="p">,</span> <span class="n">Globals</span><span class="o">.</span><span class="n">PBC</span><span class="p">)</span>
                        <span class="n">calc_moment</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">NVolAtoms</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">finalPos</span><span class="p">,</span> <span class="n">centreMass</span><span class="p">,</span> <span class="n">cellDims</span><span class="p">,</span> <span class="n">Globals</span><span class="o">.</span><span class="n">PBC</span><span class="p">,</span> <span class="n">moment</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">centreMass</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalMoment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moment</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalDVIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalCOM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalMoment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finalDVIndex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1">#                 if result.final is not None:</span>
    <span class="c1">#                     if len(result.final.defectVolumesKeys) == len(self.oldState.defectVolumesKeys) and currentVolIndex &lt; len(result.final.defectVolumesKeys):</span>
    <span class="c1">#                     # calculate the min COM difference, find the hashkey of final for the transition</span>
    <span class="c1">#                         minDiff = 1000</span>
    <span class="c1">#                         minNum = None</span>
    <span class="c1">#                         for num in range(len(result.final.defectVolumesKeys)):</span>
    <span class="c1">#                             diff = Vectors.separation(self.oldState.defectVolumes[currentVolIndex].com,</span>
    <span class="c1">#                                                       result.final.defectVolumes[num].com, self.oldState.cellDims)</span>
    <span class="c1"># #                             print num, diff, self.oldState.defectVolumesKeys[currentVolIndex], result.final.defectVolumesKeys[num]</span>
    <span class="c1">#                             if diff &lt; minDiff:</span>
    <span class="c1">#                                 minDiff = diff</span>
    <span class="c1">#                                 minNum = num</span>
    <span class="c1">#                         log(__name__, &quot;Debug: final COM minDiff %f, currentVolIndex %d, minNum %d, hashkey %s&quot;%(minDiff,currentVolIndex, minNum, result.final.defectVolumesKeys[minNum]),2,3)</span>
    <span class="c1">#</span>
    <span class="c1">#                         self.resultsDict[&quot;finalHashkey&quot;].append(result.final.defectVolumes[minNum].graphKey)</span>
    <span class="c1">#                         self.resultsDict[&quot;finalCOM&quot;].append(result.final.defectVolumes[minNum].com)</span>
    <span class="c1">#                         self.resultsDict[&quot;finalMoment&quot;].append(result.final.defectVolumes[minNum].moment)</span>
    <span class="c1">#                         self.resultsDict[&quot;finalDVIndex&quot;].append(minNum)</span>
    <span class="c1">#                     else:</span>
    <span class="c1">#                         self.resultsDict[&quot;finalHashkey&quot;].append(None)</span>
    <span class="c1">#                         self.resultsDict[&quot;finalCOM&quot;].append(None)</span>
    <span class="c1">#                         self.resultsDict[&quot;finalMoment&quot;].append(None)</span>
    <span class="c1">#                         self.resultsDict[&quot;finalDVIndex&quot;].append(None)</span>
    <span class="c1">#                         self.resultsDict[&quot;basinFlag&quot;][-1] = 0</span>
    <span class="c1">#                 else:</span>
    <span class="c1">#                     self.resultsDict[&quot;finalHashkey&quot;].append(None)</span>
    <span class="c1">#                     self.resultsDict[&quot;finalCOM&quot;].append(None)</span>
    <span class="c1">#                     self.resultsDict[&quot;finalMoment&quot;].append(None)</span>
    <span class="c1">#                     self.resultsDict[&quot;finalDVIndex&quot;].append(None)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">NStored</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NCompleted</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessful</span><span class="p">[</span><span class="n">currentVolIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessfulTot</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NCompletedTot</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># write to Roulette file</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rouletteFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">writeRouletteEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NStoredTot</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.finishLeftRateCalculations"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.finishLeftRateCalculations">[docs]</a>    <span class="k">def</span> <span class="nf">finishLeftRateCalculations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finishes all unfinished rate calculations</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">unfinishedCalc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unfinishedRateCalculations</span><span class="p">:</span>

            <span class="n">volIndex</span> <span class="o">=</span> <span class="n">unfinishedCalc</span><span class="o">.</span><span class="n">volIndex</span>
            <span class="n">barrier</span> <span class="o">=</span> <span class="n">unfinishedCalc</span><span class="o">.</span><span class="n">barrier</span>
            <span class="n">saddleSumLogEVs</span> <span class="o">=</span> <span class="n">unfinishedCalc</span><span class="o">.</span><span class="n">saddleSumLogEVs</span>
            <span class="n">resultIndex</span> <span class="o">=</span> <span class="n">unfinishedCalc</span><span class="o">.</span><span class="n">resultIndex</span>
            <span class="nb">print</span> <span class="s2">&quot;FINISHER&quot;</span><span class="p">,</span> <span class="n">volIndex</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">resultIndex</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFinish</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">iniEVCalcFail</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]:</span>
                <span class="n">rate</span><span class="p">,</span> <span class="n">prefactor</span> <span class="o">=</span> <span class="n">Rates</span><span class="o">.</span><span class="n">calculateRateWithEigenValues</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iniEVSumOfLogs</span><span class="p">[</span><span class="n">volIndex</span><span class="p">],</span> <span class="n">saddleSumLogEVs</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;WARNING: initial eigenvalue calculation on volume &quot;</span><span class="p">,</span> <span class="n">volIndex</span><span class="p">,</span>  <span class="s2">&quot; failed. Using default prefactor.&quot;</span>
                <span class="n">rate</span><span class="p">,</span> <span class="n">prefactor</span> <span class="o">=</span> <span class="n">Rates</span><span class="o">.</span><span class="n">calculateRate</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">calcPrefactor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">jobID</span><span class="o">=</span><span class="n">unfinishedCalc</span><span class="o">.</span><span class="n">jobID</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">resultIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">rate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;prefactors&quot;</span><span class="p">][</span><span class="n">resultIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">prefactor</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">totalRate</span> <span class="o">+=</span> <span class="n">rate</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">ratesListProxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rate</span>

                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ratesListLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrDebugTotalRates</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">volumeTotalRate</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">volumeRateChange</span><span class="p">[</span><span class="n">volIndex</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumeTotalRate</span><span class="p">[</span><span class="n">volIndex</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">totalRateChange</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalRate</span><span class="p">)</span></div>


            <span class="c1"># self.writeRouletteEvent(resultIndex)</span>
<div class="viewcode-block" id="KMCStepResults.writeRouletteHeader"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.writeRouletteHeader">[docs]</a>    <span class="k">def</span> <span class="nf">writeRouletteHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write header to Roulette file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Available events:</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rouletteFile</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.writeRouletteHeaderBasin"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.writeRouletteHeaderBasin">[docs]</a>    <span class="k">def</span> <span class="nf">writeRouletteHeaderBasin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write header to Roulette file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Available events for basin method:</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rouletteFile</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;append&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.writeRouletteEvent"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.writeRouletteEvent">[docs]</a>    <span class="k">def</span> <span class="nf">writeRouletteEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eventIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write given event to Roulette file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmpWords</span> <span class="o">=</span> <span class="s2">&quot;EVENT_TYPE_HERE&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cascOn</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cascRate</span><span class="p">:</span>
            <span class="n">tmpWords</span> <span class="o">=</span> <span class="s2">&quot;cascade&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">depoOn</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">depoRate</span><span class="p">:</span>
            <span class="n">tmpWords</span> <span class="o">=</span> <span class="s2">&quot;deposition&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmpWords</span> <span class="o">=</span> <span class="s2">&quot;transition&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reverseBarriers&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">: </span><span class="si">%r</span><span class="s2">. Barrier: </span><span class="si">%g</span><span class="s2"> (None); Rate: </span><span class="si">%g</span><span class="s2">; Prefactor: </span><span class="si">%g</span><span class="s2">; volIndx: </span><span class="si">%r</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eventIndex</span><span class="p">,</span> <span class="n">tmpWords</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;prefactors&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volIndxs&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">: </span><span class="si">%r</span><span class="s2">. Barrier: </span><span class="si">%g</span><span class="s2"> (</span><span class="si">%g</span><span class="s2">); Rate: </span><span class="si">%g</span><span class="s2">; Prefactor: </span><span class="si">%g</span><span class="s2">; volIndx: </span><span class="si">%r</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eventIndex</span><span class="p">,</span> <span class="n">tmpWords</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;reverseBarriers&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;rates&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;prefactors&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;volIndxs&quot;</span><span class="p">][</span><span class="n">eventIndex</span><span class="p">])</span>

        <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rouletteFile</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;append&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.writeRouletteFooter"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.writeRouletteFooter">[docs]</a>    <span class="k">def</span> <span class="nf">writeRouletteFooter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chosenIndex</span><span class="p">,</span> <span class="n">simulationTime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write footer to Roulette file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Chosen event: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">chosenIndex</span><span class="p">,)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">][</span><span class="n">chosenIndex</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;  Barrier: </span><span class="si">%g</span><span class="s2"> eV</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">][</span><span class="n">chosenIndex</span><span class="p">],)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;Simulation time: </span><span class="si">%.20g</span><span class="s2"> s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">simulationTime</span><span class="p">,)</span>

        <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rouletteFile</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;append&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.processDebugOutputData"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.processDebugOutputData">[docs]</a>    <span class="k">def</span> <span class="nf">processDebugOutputData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># For now it does only for saddle search (Dimer method)</span>
        <span class="n">timingDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>

        <span class="c1"># Processing debug info from saddle search algorithm</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;debugSadSearch&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Statistics</span>
            <span class="n">elapsedTimeMin</span> <span class="o">=</span> <span class="mf">9999999.0</span>
            <span class="n">elapsedTimeAvg</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">elapsedTimeMax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999999.0</span>

            <span class="n">stepsMin</span> <span class="o">=</span> <span class="mf">9999999.0</span>
            <span class="n">stepsAvg</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">stepsMax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999999.0</span>

            <span class="n">forceEvalsMin</span> <span class="o">=</span> <span class="mf">9999999.0</span>
            <span class="n">forceEvalsAvg</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">forceEvalsMax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999999.0</span>

            <span class="n">transForceEvalsMin</span> <span class="o">=</span> <span class="mf">9999999.0</span>
            <span class="n">transForceEvalsAvg</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">transForceEvalsMax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999999.0</span>

            <span class="n">rotForceEvalsMin</span> <span class="o">=</span> <span class="mf">9999999.0</span>
            <span class="n">rotForceEvalsAvg</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">rotForceEvalsMax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999999.0</span>

            <span class="n">maxRotTimeMin</span> <span class="o">=</span> <span class="mf">9999999.0</span>
            <span class="n">maxRotTimeAvg</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">maxRotTimeMax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999999.0</span>

            <span class="c1"># Plotting</span>
            <span class="n">y1aVals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">y1bVals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">y2Vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xValTransNames</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">debugSadSearch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;debugSadSearch&quot;</span><span class="p">]:</span>

                <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1">#                xValTransNames.append(&quot;Trans&quot; + str(cnt))</span>
<span class="c1">#                y1aVals.append(debugSadSearch.dimerTransFEvals)</span>
<span class="c1">#                y1bVals.append(debugSadSearch.dimerRotFEvals)</span>
<span class="c1">#                y2Vals.append(debugSadSearch.elapsedTime)</span>

                <span class="c1"># Elapsed time statistics</span>
                <span class="n">elapsedTimeMin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">elapsedTimeMin</span><span class="p">,</span> <span class="n">debugSadSearch</span><span class="o">.</span><span class="n">elapsedTime</span><span class="p">)</span>
                <span class="n">elapsedTimeAvg</span> <span class="o">+=</span> <span class="n">debugSadSearch</span><span class="o">.</span><span class="n">elapsedTime</span>
                <span class="n">elapsedTimeMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">elapsedTimeMax</span><span class="p">,</span> <span class="n">debugSadSearch</span><span class="o">.</span><span class="n">elapsedTime</span><span class="p">)</span>

<span class="c1">#                # Steps used statistics</span>
<span class="c1">#                stepsMin = min(stepsMin, debugSadSearch.totSteps)</span>
<span class="c1">#                stepsAvg += debugSadSearch.totSteps</span>
<span class="c1">#                stepsMax = max(stepsMax, debugSadSearch.totSteps)</span>
<span class="c1">#</span>
<span class="c1">#                # Total force evaluations used statistics</span>
<span class="c1">#                forceEvalsMin = min(forceEvalsMin, debugSadSearch.totFEvals)</span>
<span class="c1">#                forceEvalsAvg += debugSadSearch.totFEvals</span>
<span class="c1">#                forceEvalsMax = max(forceEvalsMax, debugSadSearch.totFEvals)</span>
<span class="c1">#</span>
<span class="c1">#                # Force evaluations used within the translation step statistics</span>
<span class="c1">#                transForceEvalsMin = min(transForceEvalsMin, debugSadSearch.dimerTransFEvals)</span>
<span class="c1">#                transForceEvalsAvg += debugSadSearch.dimerTransFEvals</span>
<span class="c1">#                transForceEvalsMax = max(transForceEvalsMax, debugSadSearch.dimerTransFEvals)</span>
<span class="c1">#</span>
<span class="c1">#                # Force evaluations used within the rotation step statistics</span>
<span class="c1">#                rotForceEvalsMin = min(rotForceEvalsMin, debugSadSearch.dimerRotFEvals)</span>
<span class="c1">#                rotForceEvalsAvg += debugSadSearch.dimerRotFEvals</span>
<span class="c1">#                rotForceEvalsMax = max(rotForceEvalsMax, debugSadSearch.dimerRotFEvals)</span>
<span class="c1">#</span>
<span class="c1">#                # Maximum elapsed time during the one rotation step statistics</span>
<span class="c1">#                maxRotTimeMin = min(maxRotTimeMin, debugSadSearch.dimerMaxRotTime)</span>
<span class="c1">#                maxRotTimeAvg += debugSadSearch.dimerMaxRotTime</span>
<span class="c1">#                maxRotTimeMax = max(maxRotTimeMax, debugSadSearch.dimerMaxRotTime)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;sadSearchDebug&quot;</span>

                <span class="n">elapsedTimeAvg</span> <span class="o">=</span> <span class="n">elapsedTimeAvg</span> <span class="o">/</span> <span class="n">cnt</span>
                <span class="n">stepsAvg</span> <span class="o">=</span> <span class="n">stepsAvg</span> <span class="o">/</span> <span class="n">cnt</span>
                <span class="n">forceEvalsAvg</span> <span class="o">=</span> <span class="n">forceEvalsAvg</span> <span class="o">/</span> <span class="n">cnt</span>
                <span class="n">transForceEvalsAvg</span> <span class="o">=</span> <span class="n">transForceEvalsAvg</span> <span class="o">/</span> <span class="n">cnt</span>
                <span class="n">rotForceEvalsAvg</span> <span class="o">=</span> <span class="n">rotForceEvalsAvg</span> <span class="o">/</span> <span class="n">cnt</span>
                <span class="n">maxRotTimeAvg</span> <span class="o">=</span> <span class="n">maxRotTimeAvg</span> <span class="o">/</span> <span class="n">cnt</span>

                <span class="c1"># Text file</span>
                <span class="n">fileStr</span> <span class="o">=</span> <span class="s2">&quot;ELAPSED TIME: </span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">fileStr</span> <span class="o">+=</span> <span class="s2">&quot;    MIN TIME: </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elapsedTimeMin</span><span class="p">)</span>
                <span class="n">fileStr</span> <span class="o">+=</span> <span class="s2">&quot;    AVG TIME: </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elapsedTimeAvg</span><span class="p">)</span>
                <span class="n">fileStr</span> <span class="o">+=</span> <span class="s2">&quot;    MAX TIME: </span><span class="si">%lf</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elapsedTimeMax</span><span class="p">)</span>

<span class="c1">#                fileStr += &quot;STEPS: \n&quot;</span>
<span class="c1">#                fileStr += &quot;    MIN STEPS: %d\n&quot; % (stepsMin)</span>
<span class="c1">#                fileStr += &quot;    AVG STEPS: %d\n&quot; % (stepsAvg)</span>
<span class="c1">#                fileStr += &quot;    MAX STEPS: %d\n&quot; % (stepsMax)</span>
<span class="c1">#</span>
<span class="c1">#                fileStr += &quot;TOTAL FORCE EVALUATIONS: \n&quot;</span>
<span class="c1">#                fileStr += &quot;    MIN FEVALS: %d\n&quot; % (forceEvalsMin)</span>
<span class="c1">#                fileStr += &quot;    AVG FEVALS: %d\n&quot; % (forceEvalsAvg)</span>
<span class="c1">#                fileStr += &quot;    MAX FEVALS: %d\n&quot; % (forceEvalsMax)</span>
<span class="c1">#</span>
<span class="c1">#                fileStr += &quot;TOTAL TRANSLATION STEP FORCE EVALUATIONS: \n&quot;</span>
<span class="c1">#                fileStr += &quot;    MIN FEVALS: %d\n&quot; % (transForceEvalsMin)</span>
<span class="c1">#                fileStr += &quot;    AVG FEVALS: %d\n&quot; % (transForceEvalsAvg)</span>
<span class="c1">#                fileStr += &quot;    MAX FEVALS: %d\n&quot; % (transForceEvalsMax)</span>
<span class="c1">#</span>
<span class="c1">#                fileStr += &quot;TOTAL ROTATION STEP FORCE EVALUATIONS : \n&quot;</span>
<span class="c1">#                fileStr += &quot;    MIN FEVALS: %d\n&quot; % (rotForceEvalsMin)</span>
<span class="c1">#                fileStr += &quot;    AVG FEVALS: %d\n&quot; % (rotForceEvalsAvg)</span>
<span class="c1">#                fileStr += &quot;    MAX FEVALS: %d\n&quot; % (rotForceEvalsMax)</span>
<span class="c1">#</span>
<span class="c1">#                fileStr += &quot;MAX ELAPSED TIME PER ROTATION STEP: \n&quot;</span>
<span class="c1">#                fileStr += &quot;    MIN TIME: %lf\n&quot; % (maxRotTimeMin)</span>
<span class="c1">#                fileStr += &quot;    AVG TIME: %lf\n&quot; % (maxRotTimeAvg)</span>
<span class="c1">#                fileStr += &quot;    MAX TIME: %lf\n&quot; % (maxRotTimeMax)</span>

                <span class="c1"># Saving statistics into a file</span>
                <span class="n">textObject</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">fileStr</span><span class="p">)</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObject</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">timingDir</span><span class="p">)</span>

                <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

                <span class="c1"># Plot</span>
<span class="c1">#                args = (filename, xValTransNames, y1aVals, y1bVals, y2Vals)</span>
<span class="c1">#                kwargs = {&quot;y1label&quot;:&quot;Force evals.&quot;, &quot;y2label&quot;:&quot; Time (s.)&quot;, &quot;y1aleg&quot;:&quot;Trans.F.Evals.&quot;, &quot;y1bleg&quot;:&quot;Rot.F.Evals.&quot;, &quot;y2leg&quot;:&quot;Elapsed time&quot;, &quot;title&quot;:&quot;Dimer method force evaluations and timings&quot;}</span>
<span class="c1">#</span>
<span class="c1">#                writerItem = Writer.WriterItem(&quot;PLOT&quot;, dataType=&quot;plot&quot;, data=[], outdir=timingDir)</span>
<span class="c1">#                writerItem.commands.append([&quot;stackedBarChart&quot;, args, kwargs])</span>
<span class="c1">#                self.writer.add(writerItem)</span>

<div class="viewcode-block" id="KMCStepResults.processTimingResults"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.processTimingResults">[docs]</a>    <span class="k">def</span> <span class="nf">processTimingResults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Summarises timelog results.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">timingDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="s2">&quot;timings&quot;</span><span class="p">)</span>

        <span class="n">numOfUniqueMethods</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">listOfUniqueMethods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">timingStats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">timingData</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Getting the number of called unique methods</span>
        <span class="k">for</span> <span class="n">timeLogResult</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;timing&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">timeLogResult</span><span class="o">.</span><span class="n">taskList</span><span class="p">)):</span>

                <span class="n">timeLogTask</span> <span class="o">=</span> <span class="n">timeLogResult</span><span class="o">.</span><span class="n">taskList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">timeLog</span> <span class="o">=</span> <span class="n">timeLogResult</span><span class="o">.</span><span class="n">timeList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">succLog</span> <span class="o">=</span> <span class="n">timeLogResult</span><span class="o">.</span><span class="n">succList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="c1"># if timeLog = -1.0 it means that we should not track it</span>
                <span class="k">if</span> <span class="n">timeLog</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">timeLogTask</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listOfUniqueMethods</span><span class="p">:</span>
                        <span class="n">lineNo</span> <span class="o">=</span> <span class="n">numOfUniqueMethods</span>

                        <span class="n">numOfUniqueMethods</span> <span class="o">=</span> <span class="n">numOfUniqueMethods</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">listOfUniqueMethods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timeLogTask</span><span class="p">)</span>

                        <span class="n">timingStats</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">99999999.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">99999999.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">99999999.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

                        <span class="n">timingData</span><span class="p">[</span><span class="n">timeLogTask</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">timingData</span><span class="p">[</span><span class="n">timeLogTask</span><span class="o">+</span><span class="s2">&quot;SUCC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">timingData</span><span class="p">[</span><span class="n">timeLogTask</span><span class="o">+</span><span class="s2">&quot;UNSUCC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lineNo</span> <span class="o">=</span> <span class="n">listOfUniqueMethods</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">timeLogTask</span><span class="p">)</span>

                    <span class="c1"># Adding to total call count</span>
                    <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
                    <span class="c1"># Checking if it is minimum of all calls</span>
                    <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">timeLog</span><span class="p">)</span>
                    <span class="c1"># Checking if it is maximum of all calls</span>
                    <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">timeLog</span><span class="p">)</span>
                    <span class="c1"># Summing all time from all calls</span>
                    <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">timeLog</span>

                    <span class="n">timingData</span><span class="p">[</span><span class="n">timeLogTask</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timeLog</span><span class="p">)</span>

                    <span class="c1"># if the call was successful</span>
                    <span class="k">if</span> <span class="n">succLog</span><span class="p">:</span>
                        <span class="c1"># Adding to successful call count</span>
                        <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
                        <span class="c1"># Checking if it is minimum of successful calls</span>
                        <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="n">timeLog</span><span class="p">)</span>
                        <span class="c1"># Checking if it is maximum of successful calls</span>
                        <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="n">timeLog</span><span class="p">)</span>
                        <span class="c1"># Summing all time from successful calls</span>
                        <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="n">timeLog</span>

                        <span class="n">timingData</span><span class="p">[</span><span class="n">timeLogTask</span><span class="o">+</span><span class="s2">&quot;SUCC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timeLog</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Adding to unsuccessful call count</span>
                        <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
                        <span class="c1"># Checking if it is minimum of unsuccessful calls</span>
                        <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">9</span><span class="p">],</span> <span class="n">timeLog</span><span class="p">)</span>
                        <span class="c1"># Checking if it is maximum of unsuccessful calls</span>
                        <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="n">timeLog</span><span class="p">)</span>
                        <span class="c1"># Summing all time from unsuccessful calls</span>
                        <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">lineNo</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">+</span> <span class="n">timeLog</span>

                        <span class="n">timingData</span><span class="p">[</span><span class="n">timeLogTask</span><span class="o">+</span><span class="s2">&quot;UNSUCC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timeLog</span><span class="p">)</span>

        <span class="c1"># lets finish with averages</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numOfUniqueMethods</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">if</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">if</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">/</span> <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timingStats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># now we have all the data that we need. Lets make some output</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="s2">&quot;methodStats.OUT&quot;</span>
        <span class="n">fileStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">methodIdx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numOfUniqueMethods</span><span class="p">):</span>
            <span class="n">methodName</span> <span class="o">=</span> <span class="n">listOfUniqueMethods</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">]</span>

            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;Method name: &quot;</span> <span class="o">+</span> <span class="n">methodName</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Total calls: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Min time (s.): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Avg time (s.): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Max time (s.): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Successful calls: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Min time (s.): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Avg time (s.): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Max time (s.): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Unsuccessful calls: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">8</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Min time (s.): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">9</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Avg time (s.): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">11</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Max time (s.): &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timingStats</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">][</span><span class="mi">10</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileStr</span> <span class="o">+</span> <span class="s2">&quot;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ </span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Saving statistics into a file</span>
        <span class="n">textObject</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">fileStr</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObject</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">timingDir</span><span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># Lets plot</span>
        <span class="c1"># Plotting every function&#39;s call time</span>
        <span class="k">for</span> <span class="n">methodIdx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numOfUniqueMethods</span><span class="p">):</span>

            <span class="n">methodName</span> <span class="o">=</span> <span class="n">listOfUniqueMethods</span><span class="p">[</span><span class="n">methodIdx</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timingData</span><span class="p">[</span><span class="n">methodName</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">methodName</span> <span class="o">+</span> <span class="s2">&quot;_TotTime&quot;</span>

                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">timingData</span><span class="p">[</span><span class="n">methodName</span><span class="p">],</span> <span class="s2">&quot;Time (s.)&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of calls&quot;</span><span class="p">)</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">methodName</span> <span class="o">+</span> <span class="s2">&quot;: </span><span class="si">%d</span><span class="s2"> Total times called&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">timingData</span><span class="p">[</span><span class="n">methodName</span><span class="p">]),)}</span>
                <span class="n">writerItem</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;PLOT&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">timingDir</span><span class="p">)</span>
                <span class="n">writerItem</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;histogram&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">writerItem</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timingData</span><span class="p">[</span><span class="n">methodName</span><span class="o">+</span><span class="s2">&quot;SUCC&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">methodName</span> <span class="o">+</span> <span class="s2">&quot;_SuccTime&quot;</span>

                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">timingData</span><span class="p">[</span><span class="n">methodName</span><span class="o">+</span><span class="s2">&quot;SUCC&quot;</span><span class="p">],</span> <span class="s2">&quot;Time (s.)&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of calls&quot;</span><span class="p">)</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">methodName</span> <span class="o">+</span> <span class="s2">&quot;: </span><span class="si">%d</span><span class="s2"> times successfully called&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">timingData</span><span class="p">[</span><span class="n">methodName</span><span class="o">+</span><span class="s2">&quot;SUCC&quot;</span><span class="p">]),)}</span>
                <span class="n">writerItem</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;PLOT&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">timingDir</span><span class="p">)</span>
                <span class="n">writerItem</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;histogram&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">writerItem</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timingData</span><span class="p">[</span><span class="n">methodName</span><span class="o">+</span><span class="s2">&quot;UNSUCC&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">methodName</span> <span class="o">+</span> <span class="s2">&quot;_UnsuccTime&quot;</span>

                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">timingData</span><span class="p">[</span><span class="n">methodName</span><span class="o">+</span><span class="s2">&quot;UNSUCC&quot;</span><span class="p">],</span> <span class="s2">&quot;Time (s.)&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of calls&quot;</span><span class="p">)</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">methodName</span> <span class="o">+</span> <span class="s2">&quot;: </span><span class="si">%d</span><span class="s2"> times unsuccessfully called&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">timingData</span><span class="p">[</span><span class="n">methodName</span><span class="o">+</span><span class="s2">&quot;UNSUCC&quot;</span><span class="p">]),)}</span>
                <span class="n">writerItem</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;PLOT&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">timingDir</span><span class="p">)</span>
                <span class="n">writerItem</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;histogram&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">writerItem</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.summarise"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.summarise">[docs]</a>    <span class="k">def</span> <span class="nf">summarise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Summarise results.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Out of </span><span class="si">%d</span><span class="s2"> transition searches </span><span class="si">%d</span><span class="s2"> were successful (</span><span class="si">%d</span><span class="s2"> unique)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NJobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NSuccessful</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NStored</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.finalise"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.finalise">[docs]</a>    <span class="k">def</span> <span class="nf">finalise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do anything that needs to be done at the end of a task.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processDebugOutputData</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrOutputTiming</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processTimingResults</span><span class="p">()</span>

        <span class="c1"># distribution of barriers</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;barriers&quot;</span><span class="p">]):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;barrierDistribution&quot;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s1">&#39;barriers&#39;</span><span class="p">],</span> <span class="s2">&quot;Barrier energy (eV)&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of barriers&quot;</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> barriers found&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s1">&#39;barriers&#39;</span><span class="p">]),)}</span>
            <span class="n">writerItem</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;PLOT&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">)</span>
            <span class="n">writerItem</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;histogram&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">writerItem</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrDebugSearches</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">searchFailedReasons</span><span class="p">):</span>
            <span class="n">text_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">nl</span> <span class="o">=</span> <span class="n">text_lines</span><span class="o">.</span><span class="n">append</span>

            <span class="c1"># header</span>
            <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;Reason, Number&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">searchFailedReasons</span><span class="p">):</span>
                <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">searchFailedReasons</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

            <span class="n">text_object</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text_lines</span><span class="p">,</span> <span class="n">textAsLines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;search_failed_reasons.csv&quot;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">writerItem</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">text_object</span><span class="p">],</span> <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">)</span>
            <span class="n">writerItem</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">writerItem</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.searchTimingOutput"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.searchTimingOutput">[docs]</a>    <span class="k">def</span> <span class="nf">searchTimingOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output stats for Search timing</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="s2">&quot;search.timing.dir&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;searchTimingAll&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">:</span>
            <span class="n">allDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;searchTimingAll&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">allDict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s2">&quot;searchTimingSuccess&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">:</span>
            <span class="n">successDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;searchTimingSuccess&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">successDict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s2">&quot;searchTimingFailure&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">:</span>
            <span class="n">failureDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;searchTimingFailure&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">failureDict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># keys</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">allDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Search timing output&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Keys: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">keys</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># arrays for results</span>
        <span class="n">allMeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">allErrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">succMeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">succErrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">failMeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">failErrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">allMaxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">succMaxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">failMaxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">allMins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">succMins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">failMins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="c1"># number of results</span>
        <span class="n">numAll</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">numSuccess</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">numFailure</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">allDict</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">allDict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">numAll</span><span class="p">:</span>
                <span class="n">numAll</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">allDict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">successDict</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">successDict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">numSuccess</span><span class="p">:</span>
                <span class="n">numSuccess</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">successDict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">failureDict</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">failureDict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">numFailure</span><span class="p">:</span>
                <span class="n">numFailure</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failureDict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="c1"># results</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">allDict</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">allDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">allMeans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">allErrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
                <span class="n">allMaxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">allMins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">successDict</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">successDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">succMeans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">succErrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
                <span class="n">succMaxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">succMins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">failureDict</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">failureDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">failMeans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">failErrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
                <span class="n">failMaxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">failMins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># output file</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">append</span>
        <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;Search timing output&quot;</span><span class="p">)</span>
        <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> total searches&quot;</span> <span class="o">%</span> <span class="n">numAll</span><span class="p">)</span>
        <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> success/duplicate&quot;</span> <span class="o">%</span> <span class="n">numSuccess</span><span class="p">)</span>
        <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> failure&quot;</span> <span class="o">%</span> <span class="n">numFailure</span><span class="p">)</span>
        <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;Keys, Overall (s), Success (s), Failure (s)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%.3f</span><span class="s2"> ± </span><span class="si">%.3f</span><span class="s2"> (</span><span class="si">%.3f</span><span class="s2"> -&gt; </span><span class="si">%.3f</span><span class="s2">), </span><span class="si">%.3f</span><span class="s2"> ± </span><span class="si">%.3f</span><span class="s2"> (</span><span class="si">%.3f</span><span class="s2"> -&gt; </span><span class="si">%.3f</span><span class="s2">), </span><span class="si">%.3f</span><span class="s2"> ± </span><span class="si">%.3f</span><span class="s2"> (</span><span class="si">%.3f</span><span class="s2"> -&gt; </span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">allMeans</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">allErrs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                                                           <span class="n">allMins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">allMaxes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                                                           <span class="n">succMeans</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">succErrs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                                                           <span class="n">succMins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">succMaxes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                                                           <span class="n">failMeans</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">failErrs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                                                           <span class="n">failMins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">failMaxes</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># write results</span>
        <span class="n">textObject</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">textAsLines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObject</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outputDir</span><span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;searchTiming.csv&quot;</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.rateDebuggingOutput"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.rateDebuggingOutput">[docs]</a>    <span class="k">def</span> <span class="nf">rateDebuggingOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output stats for rate debugging.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="s2">&quot;rates.debug.dir&quot;</span><span class="p">)</span>

        <span class="c1"># total rate</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalRateChange</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalRateChange</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="c1"># plot</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;totalRate&quot;</span><span class="p">,</span> <span class="n">xvals</span><span class="p">,</span> <span class="s2">&quot;Number of searches&quot;</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="s2">&quot;Total rate&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Total rate against number of searches&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;useInterp&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">writerItem</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;PLOT&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outputDir</span><span class="p">)</span>
        <span class="n">writerItem</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;linePlot&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">writerItem</span><span class="p">)</span>

        <span class="c1"># by volume</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumeRateChange</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">yvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

            <span class="c1"># plot</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;totalRate_volume</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,),</span> <span class="n">xvals</span><span class="p">,</span> <span class="s2">&quot;Number of searches&quot;</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="s2">&quot;Total rate&quot;</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Total rate vs number of searches (Volume </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,),</span>
                      <span class="s2">&quot;useInterp&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">writerItem</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;PLOT&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outputDir</span><span class="p">)</span>
            <span class="n">writerItem</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;linePlot&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">writerItem</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.debugJobsByRank"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.debugJobsByRank">[docs]</a>    <span class="k">def</span> <span class="nf">debugJobsByRank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Debug server/clients load etc.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

        <span class="n">maxRank</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJobsByRank</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="n">maxRank</span><span class="p">:</span>
                <span class="n">maxRank</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">maxRank</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">NJobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">jobTime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">totalTime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NJobsByRank</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">NJobs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rankWorkingTime</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">totalTime</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">jobTime</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">NJobs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="n">outputDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="s2">&quot;server&quot;</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">append</span>

        <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;Rank,N Jobs,Total working time,Average time per job&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">nl</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">,</span><span class="si">%f</span><span class="s2">,</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">NJobs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">totalTime</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">jobTime</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="c1"># Saving statistics into a file</span>
        <span class="n">textObject</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObject</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outputDir</span><span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;serverStats.csv&quot;</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="KMCStepResults.writeSelectedFinal"><a class="viewcode-back" href="../../LKMC/LKMC.Results.html#LKMC.Results.KMCStepResults.writeSelectedFinal">[docs]</a>    <span class="k">def</span> <span class="nf">writeSelectedFinal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">latticeIn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the selected final to file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">latticeIn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultsDict</span><span class="p">[</span><span class="s2">&quot;finals&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lattice</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">latticeIn</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;zipfile&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,}</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">lattice</span><span class="p">,])</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;writeLattice&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div></div>


<span class="c1">################################################################################</span>
<span class="c1"># Output the debug info (if required)</span>
<span class="c1">################################################################################</span>
<span class="k">def</span> <span class="nf">_debugOutput</span><span class="p">(</span><span class="n">searchNo</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">resultID</span><span class="p">,</span> <span class="n">taskOutputDir</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">duplIdx</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">job</span> <span class="o">!=</span> <span class="s2">&quot;CALCFORCE&quot;</span><span class="p">:</span>
        <span class="c1"># write debug string into files</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">infoString</span><span class="p">:</span>

            <span class="n">debugDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="s2">&quot;debug/&quot;</span><span class="p">)</span>

            <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">infoString</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,])</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">debugDir</span> <span class="o">+</span> <span class="s2">&quot;Search</span><span class="si">%d</span><span class="s2">.debug&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">searchNo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">debugDir</span> <span class="o">+</span> <span class="s2">&quot;Search</span><span class="si">%d</span><span class="s2">Trans</span><span class="si">%d</span><span class="s2">.debug&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">searchNo</span><span class="p">,</span> <span class="n">resultID</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">debugDir</span> <span class="o">+</span> <span class="s2">&quot;Search</span><span class="si">%d</span><span class="s2">Trans</span><span class="si">%d</span><span class="s2">.debug&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">searchNo</span><span class="p">,</span> <span class="n">duplIdx</span><span class="p">)</span>

            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

<span class="c1">################################################################################</span>
<span class="c1"># Output the result (if required)</span>
<span class="c1">################################################################################</span>
<span class="k">def</span> <span class="nf">_outputResult</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">resultID</span><span class="p">,</span> <span class="n">taskOutputDir</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">inputState</span><span class="p">,</span> <span class="n">refState</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Output result if required</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># save fix index</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">fixIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">outputdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="s2">&quot;Trans</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resultID</span><span class="p">))</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;fixIndex.txt&quot;</span>
        <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">result</span><span class="o">.</span><span class="n">fixIndex</span><span class="p">)</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outputdir</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">fn</span><span class="p">,),</span> <span class="p">{}])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1"># write final to combined file</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">outputFinals</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;finals.cdt&quot;</span>

        <span class="c1"># args for writeLattice</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>

        <span class="c1"># kwargs for writeLattice</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;append&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,}</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">taskOutputDir</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;writeLattice&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1"># write saddle to combined file</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">outputSaddles</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">saddle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;saddles.cdt&quot;</span>

        <span class="c1"># args for writeLattice</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>

        <span class="c1"># kwargs for writeLattice</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;append&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,}</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">saddle</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">taskOutputDir</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;writeLattice&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1"># write/plot pathway if required</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">images</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">visualisePathways</span> <span class="ow">or</span> <span class="n">params</span><span class="o">.</span><span class="n">plotPathways</span> <span class="ow">or</span> <span class="n">params</span><span class="o">.</span><span class="n">outputPathwayCSVs</span><span class="p">):</span>

        <span class="c1"># create write item</span>
        <span class="n">outputdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="s2">&quot;Trans</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resultID</span><span class="p">))</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">images</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outputdir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">plotPathways</span><span class="p">:</span>

            <span class="c1"># plot the pathway</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;transitionPathway&quot;</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;plotBarrierSeparation&quot;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">visualisePathways</span><span class="p">:</span>

            <span class="c1"># visualise the pathway</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;visualisePathwayLattice&quot;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dozip&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,}</span>
            <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">outputPathwayCSVs</span><span class="p">:</span>
            <span class="c1"># write the csv</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;pathway&quot;</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;writeBarrierSeparation&quot;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>

        <span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">renderPOVDefectsAll</span> <span class="ow">and</span> <span class="n">refState</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">final</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># create object</span>
        <span class="n">renderer</span> <span class="o">=</span> <span class="n">Defects</span><span class="o">.</span><span class="n">DefectRenderer</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">final</span><span class="p">,</span> <span class="n">refState</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="s2">&quot;trans</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resultID</span><span class="p">,))</span>

        <span class="c1"># create write item</span>
        <span class="n">outputdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">taskOutputDir</span><span class="p">,</span> <span class="s2">&quot;Trans</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resultID</span><span class="p">,))</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;RENDER&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">renderer</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outputdir</span><span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;render&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>

        <span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">calcPrefactor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># unpack</span>
        <span class="n">ratio</span><span class="p">,</span> <span class="n">timeTaken</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">calcPrefactor</span>

        <span class="c1"># line</span>
        <span class="n">textStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ratio</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">barrier</span><span class="p">,</span> <span class="n">timeTaken</span><span class="p">)</span>

        <span class="c1"># object</span>
        <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">textStr</span><span class="p">)</span>

        <span class="c1"># writer item</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">WriterItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="s2">&quot;debugPrefactorCalc.dir&quot;</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ratio_estimated_to_total.csv&quot;</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;append&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>

        <span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LKMC 150623-1236-g1254817 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Chris Scott, Tomas Lazauskas, Miao Yu.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>