<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LKMC.Basin &mdash; LKMC 150623-1236-g1254817 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '150623-1236-g1254817',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="LKMC 150623-1236-g1254817 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LKMC 150623-1236-g1254817 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for LKMC.Basin</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module is an implementation of the Superbasin Method, which deals with the low-barrier flicker problem.</span>

<span class="sd">Copyright Miao Yu 2014</span>
<span class="sd">Copyright Mark James Wootton &amp; Adam Lloyd 2016</span>

<span class="sd">References</span>
<span class="sd">----------</span>

<span class="sd">* L.K. Beland, P. Brommer, F. El-Mellouhi, J.-F. Joly and N. Mousseau.</span>
<span class="sd">  Kinetic activation-relaxation techinique.</span>
<span class="sd">  Phy. Rev. E 84, 046704 (2011) doi: 10.1103/PhysRevE.84.046704</span>
<span class="sd">* B. Puchala, M.L. Falk and K. Garikipati.</span>
<span class="sd">  An energy basin finding algorithm for kinetic Monte Carlo acceleration.</span>
<span class="sd">  J. Chem. Phys. 132, 134104 (2010) doi: 10.1063/1.3369627</span>
<span class="sd">* K.A. Fichthorn and Y. Lin.</span>
<span class="sd">  A local superbasin kinetic Monte Carlo method.</span>
<span class="sd">  J. Chem. Phys. 138, 164104 (2013) doi: 10.1063/1.4801869</span>

<span class="sd">Note: The script is coded based on Beland&#39;s work.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Utilities</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Globals</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Refine</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Lattice</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Graphs</span>
<span class="kn">from</span> <span class="nn">.Utilities</span> <span class="k">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Dummy</span>


<div class="viewcode-block" id="TransitionObject"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.TransitionObject">[docs]</a><span class="k">class</span> <span class="nc">TransitionObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The `TransitionObject` class holds information about a transition event,</span>
<span class="sd">    which is associated with a basin state.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    barrier : float</span>
<span class="sd">        The (forward) barrier of the transition.</span>
<span class="sd">    reverseBarrier : float</span>
<span class="sd">        The backward (reverse) barrier of the transition.</span>
<span class="sd">    rate : float</span>
<span class="sd">        The original (uncorrected) rate of the transition.</span>
<span class="sd">    finalHashkey : string</span>
<span class="sd">        The (primary) hashkey of the final state of the transition.</span>
<span class="sd">    finalCOM : ndarray</span>
<span class="sd">        The (primary) Center Of Mass of the final state of the transition.</span>
<span class="sd">    reuseIndex : integer</span>
<span class="sd">        The index of transitions in the Volume file.</span>
<span class="sd">        i.e. where is this transition saved in the Volume file.</span>
<span class="sd">    flag : integer</span>
<span class="sd">        * If 0 : ordinary event;</span>
<span class="sd">        * If 1 : potential basin event;</span>
<span class="sd">        * If 2 : basin event.</span>
<span class="sd">    finalDV : integer</span>
<span class="sd">        The index of basin state where the final state of the transition pointed.</span>
<span class="sd">        i.e. the connection between basin states.</span>
<span class="sd">    final : `Lattice.Lattice` object</span>
<span class="sd">        The object holds information of the final state of the transition.</span>
<span class="sd">    index : integer</span>
<span class="sd">        The finalVolIndex in the list of defectVolumes of the final state of the transition.</span>
<span class="sd">        This might different from the currentVolIndex.</span>
<span class="sd">    savePos : bool, optional</span>
<span class="sd">        * If True : (default, only if `final` object is given) Store information about the defect volume atoms.</span>
<span class="sd">    moment : ndarray, optional</span>
<span class="sd">        The (primary) Moment of the final state of the transition.</span>
<span class="sd">    currentVolIndex : integer, optional</span>
<span class="sd">        The currentVolIndex in the list of defectVolumes of the initial state of the transtion.</span>
<span class="sd">        i.e. the index of current working volume.</span>
<span class="sd">    pair : bool</span>
<span class="sd">        Records if the transition was added as part of a pair or not (True if it was).</span>
<span class="sd">        Internal transitions should be added in pairs, while escaping transitions should not.</span>
<span class="sd">    dupRef : int</span>
<span class="sd">    Which of the graphkeys the transition goes from.</span>
<span class="sd">        * None for primary key</span>
<span class="sd">        * 0, 1, 2... for the nth entry of the duplicate key list</span>
<span class="sd">    sadCOM : list</span>
<span class="sd">        The centre of mass of the transition&#39;s saddle</span>
<span class="sd">    sadMom : list</span>
<span class="sd">        The moment of the transition&#39;s saddle</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    NDefects : integer</span>
<span class="sd">        Number of atoms in the given defect volume.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span>
                 <span class="n">reuseIndex</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">savePos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">altGraph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">dupRef</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sadCOM</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sadMom</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">barrier</span> <span class="o">=</span> <span class="n">barrier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverseBarrier</span> <span class="o">=</span> <span class="n">reverseBarrier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalHashkey</span> <span class="o">=</span> <span class="n">finalHashkey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalCOM</span> <span class="o">=</span> <span class="n">finalCOM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reuseIndex</span> <span class="o">=</span> <span class="n">reuseIndex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">=</span> <span class="n">finalDV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalVolIndex</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentVolIndex</span> <span class="o">=</span> <span class="n">currentVolIndex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">altGraph</span> <span class="o">=</span> <span class="n">altGraph</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupHashkey</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupCOM</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupMoment</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># self.dupIniGraphAtoms = []</span>
        <span class="c1"># self.dupFinGraphAtoms = []</span>
        <span class="c1"># self.dupSadGraphAtoms = []</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NDefects</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="ow">and</span> <span class="n">savePos</span> <span class="ow">and</span> <span class="n">final</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storeFinalDVInfo</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">partOfPair</span> <span class="o">=</span> <span class="n">pair</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupRef</span> <span class="o">=</span> <span class="n">dupRef</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sadCOM</span> <span class="o">=</span> <span class="n">sadCOM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sadMom</span> <span class="o">=</span> <span class="n">sadMom</span>

<div class="viewcode-block" id="TransitionObject.dupInfo"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.TransitionObject.dupInfo">[docs]</a>    <span class="k">def</span> <span class="nf">dupInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dupHashkey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dupCOM</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dupMoment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save information about the final state of the transition, if the final states</span>
<span class="sd">        have different hashkeys due to small variation.</span>

<span class="sd">        Sometimes the same final state of a transition may have different hashkeys</span>
<span class="sd">        due to small variation. Store information about the final states, which will be</span>
<span class="sd">        used to get the correct connectivities within a superbasin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dupHashkey : string, optional</span>
<span class="sd">            The (secondary) hashkey of the final state of the transition.</span>
<span class="sd">        dupCOM : ndarray, optional</span>
<span class="sd">            The (secondary) Center Of Mass of the final state of the transition.</span>
<span class="sd">        dupMoment : ndarray, optional</span>
<span class="sd">            The (secondary) Moment of the final state of the transition.</span>
<span class="sd">        moment : ndarray, optional</span>
<span class="sd">            The (primary) Moment of the final state of the transition.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling dupInfo&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>
        <span class="k">if</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupHashkey</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupCOM</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupMoment</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING, not given all duplicate information, ignore...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TransitionObject.storeFinalDVInfo"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.TransitionObject.storeFinalDVInfo">[docs]</a>    <span class="k">def</span> <span class="nf">storeFinalDVInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store information about the defect volume atoms of the transition.</span>
<span class="sd">        These information will be used to compare whether two states with different hashkeys</span>
<span class="sd">        are actually the same or not.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lattice : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about final state of the transition.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The finalVolIndex in the list of defectVolumes of the final state of the transition.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        primaryVol : ndarray</span>
<span class="sd">            Indexes of primary atoms (searchMoveVol) in the defect volume.</span>
<span class="sd">        graphVol : ndarray</span>
<span class="sd">            Indexes of graph atoms (used to calculate hashkey) in the defect volume.</span>
<span class="sd">        dvPos : ndarray</span>
<span class="sd">            Positions of primary atoms.</span>
<span class="sd">        NDefects : integer</span>
<span class="sd">            Number of atoms in the given defect volume.</span>
<span class="sd">        vacancies : ndarray</span>
<span class="sd">            Indexes of atoms (in the reference system) which are vacancies in the given defect volume.</span>
<span class="sd">        interstitials : ndarray</span>
<span class="sd">            Indexes of atoms (in the given lattice) which are interstitials in the given defect volume.</span>
<span class="sd">        antisites : ndarray</span>
<span class="sd">            Indexes of atoms (in the reference system) which are antisites in the given defect volume.</span>
<span class="sd">        onAntisites : ndarray</span>
<span class="sd">            Indexes of atoms (in the given lattice) which are onAntisites in the given defect volume.</span>
<span class="sd">        defectPos : ndarray</span>
<span class="sd">            Possitions of all defect atoms, in the order of vacancies, interstitials, onAntisites.</span>
<span class="sd">        altGraph : list of atom indexes (integers)</span>
<span class="sd">            An alternative graph list to use in instances where one must adjust a duplicate state into its primary form.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling storeFinalDVInfo&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># log(__name__ &quot;index = %d&quot; % index, 2, 1)#, lattice.defectVolumeKeys, lattice.defectVolumes[index].graphKey</span>
        <span class="c1"># store index of atoms in current defect volume</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">searchMoveVol</span>  <span class="c1">#This property could probably be removed.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">altGraph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;storeFinalDVInfo: Final is non-duplicate, using default graph volume.&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;storeFinalDVInfo: Final is a duplicate state, using alternative graph volume (i.e. version corresponding to non-duplicate form).&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">altGraph</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="c1"># log(__name__, &quot;lattice.pos&quot;, 3, 0)</span>
        <span class="c1"># log(__name__, lattice.pos, 3, 0)</span>
        <span class="c1"># log(__name__, &quot;self.graphVol&quot;, 3, 0)</span>
        <span class="c1"># log(__name__, self.graphVol, 3, 0)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)):</span>
            <span class="c1"># print &quot;here&quot;, self.dvPos[3*i], lattice.pos[3*self.graphVol[i]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># log(__name__, &quot;self.dvPos&quot;, 3, 0)</span>
        <span class="c1"># log(__name__, self.dvPos, 3, 0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NDefects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacancies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interstitials</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antisites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="DefectVolumeObject"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.DefectVolumeObject">[docs]</a><span class="k">class</span> <span class="nc">DefectVolumeObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The `DefectVolumeObject` class holds information about a basin state.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : `Lattice.Lattice` object</span>
<span class="sd">        The object holds information about the system.</span>
<span class="sd">    index : integer</span>
<span class="sd">        The currentVolIndex in the list of defectVolumes of the system.</span>
<span class="sd">    BasinObject : `BasinObject` object</span>
<span class="sd">        The object holds information about a superbasin, where the current basin state is belonged.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    hashkey : string</span>
<span class="sd">        The (primary) hashkey of the basin state.</span>
<span class="sd">    COM : ndarray</span>
<span class="sd">        The (primary) Center Of Mass of the basin state.</span>
<span class="sd">    moment : ndarray, optional</span>
<span class="sd">        The (primary) Moment of the basin state.</span>
<span class="sd">    dupHashkey : string, optional</span>
<span class="sd">        The (secondary) hashkey of the basin state.</span>
<span class="sd">    dupCOM : ndarray, optional</span>
<span class="sd">        The (secondary) Center Of Mass of the basin state.</span>
<span class="sd">    dupMoment : ndarray, optional</span>
<span class="sd">        The (secondary) Moment of the basin state.</span>
<span class="sd">    primaryVol : ndarray</span>
<span class="sd">        Indexes of primary atoms (searchMoveVol) in the defect volume of the basin state.</span>
<span class="sd">    graphVol : ndarray</span>
<span class="sd">        Indexes of graph atoms (used to calculate hashkey) in the defect volume of the basin state.</span>
<span class="sd">    dvPos : ndarray</span>
<span class="sd">        Possitions of primary atoms of the basin state.</span>
<span class="sd">    NDefects : integer</span>
<span class="sd">        Number of atoms in the given defect volume.</span>
<span class="sd">    vacancies : ndarray</span>
<span class="sd">        Indexes of atoms (in the reference system) which are vacancies in the given defect volume of the basin state.</span>
<span class="sd">    interstitials : ndarray</span>
<span class="sd">        Indexes of atoms (in the given lattice) which are interstitials in the given defect volume of the basin state.</span>
<span class="sd">    antisites : ndarray</span>
<span class="sd">        Indexes of atoms (in the reference system) which are antisites in the given defect volume of the basin state.</span>
<span class="sd">    onAntisites : ndarray</span>
<span class="sd">        Indexes of atoms (in the given lattice) which are onAntisites in the given defect volume of the basin state.</span>
<span class="sd">    defectPos : ndarray</span>
<span class="sd">        Possitions of all defect atoms, in the order of vacancies, interstitials, onAntisites.</span>
<span class="sd">    transitions : list</span>
<span class="sd">        List of `TransitionObject` objects. Holds information of transitions associated with this basin state.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">BasinObject</span><span class="p">,</span> <span class="n">debugMode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">debugMode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hashkey</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">COM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hashkey</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">COM</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">com</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>
            <span class="c1"># store index of atoms in current defect volume</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">searchMoveVol</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dupHashkey</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupCOM</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupMoment</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupVolAtoms</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dupPos</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">debugMode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NDefects</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vacancies</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interstitials</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">antisites</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onAntisites</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defectPos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NDefects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacancies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interstitials</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antisites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span> <span class="o">=</span> <span class="n">BasinObject</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">explored</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="DefectVolumeObject.dupInfo"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.DefectVolumeObject.dupInfo">[docs]</a>    <span class="k">def</span> <span class="nf">dupInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dupHashkey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dupCOM</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dupMoment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save information about the basin state, if the basin states</span>
<span class="sd">        have different hashkeys due to small variation.</span>

<span class="sd">        Sometimes the same basin state may have different hashkeys</span>
<span class="sd">        due to small variation. Store information about the basin states, which will be</span>
<span class="sd">        used to get the correct connectivities within a superbasin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dupHashkey : string, optional</span>
<span class="sd">            The (secondary) hashkey of the final state of the transition.</span>
<span class="sd">        dupCOM : ndarray, optional</span>
<span class="sd">            The (secondary) Center Of Mass of the final state of the transition.</span>
<span class="sd">        dupMoment : ndarray, optional</span>
<span class="sd">            The (secondary) Moment of the final state of the transition.</span>
<span class="sd">        moment : ndarray, optional</span>
<span class="sd">            The (primary) Moment of the final state of the transition.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling dupInfo&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>
        <span class="k">if</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupHashkey</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupCOM</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupMoment</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING, not given all duplicate information, ignore...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefectVolumeObject.createTrans"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.DefectVolumeObject.createTrans">[docs]</a>    <span class="k">def</span> <span class="nf">createTrans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span>
                    <span class="n">reuseIndex</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savePos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">altGraph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">dupRef</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sadCOM</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sadMom</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a transition associated with current basin state.</span>
<span class="sd">            * If already stored, pass;</span>
<span class="sd">            * If not stored, create a `TransitionObject` object and store it.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        barrier : float</span>
<span class="sd">            The (forward) barrier of the transition.</span>
<span class="sd">        reverseBarrier : float</span>
<span class="sd">            The backward (reverse) barrier of the transition.</span>
<span class="sd">        rate : float</span>
<span class="sd">            The original (uncorrected) rate of the transition.</span>
<span class="sd">        finalHashkey : string</span>
<span class="sd">            The (primary) hashkey of the final state of the transition.</span>
<span class="sd">        finalCOM : ndarray</span>
<span class="sd">            The (primary) Center Of Mass of the final state of the transition.</span>
<span class="sd">        reuseIndex : integer</span>
<span class="sd">            The index of transitions in the Volume file.</span>
<span class="sd">            i.e. where does this transition save in the Volume file.</span>
<span class="sd">        flag : integer</span>
<span class="sd">            * If 0 : ordinary event;</span>
<span class="sd">            * If 1 : potential basin event;</span>
<span class="sd">            * If 2 : basin event.</span>
<span class="sd">        finalDV : integer</span>
<span class="sd">            The index of basin state where the final state of the transition pointed.</span>
<span class="sd">            i.e. the connection between basin states.</span>
<span class="sd">        final : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information of the final state of the transition.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The finalVolIndex in the list of defectVolumes of the final state of the transition.</span>
<span class="sd">            This might different from the currentVolIndex.</span>
<span class="sd">        savePos : bool, optional</span>
<span class="sd">            * If True : (default, only if `final` object is given) Store information about the defect volume atoms.</span>
<span class="sd">        moment : ndarray, optional</span>
<span class="sd">            The (primary) Moment of the final state of the transition.</span>
<span class="sd">        currentVolIndex : integer, optional</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the initial state of the transtion.</span>
<span class="sd">            i.e. the index of current working volume.</span>
<span class="sd">        pair : bool</span>
<span class="sd">            Records if the transition was added as part of a pair or not (True if it was).</span>
<span class="sd">            Internal transitions should be added in pairs, while escaping transitions should not.</span>
<span class="sd">        dupRef : int</span>
<span class="sd">        Which of the graphkeys the transition goes from.</span>
<span class="sd">            * None for primary key</span>
<span class="sd">            * 0, 1, 2... for the nth entry of the duplicate key list</span>
<span class="sd">        sadCOM : list</span>
<span class="sd">            The centre of mass of the transition&#39;s saddle</span>
<span class="sd">        sadMom : list</span>
<span class="sd">            The moment of the transition&#39;s saddle</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : integer</span>
<span class="sd">            * If 0 : successfully create and store the transition;</span>
<span class="sd">            * If 1 : cannot store the transition.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling createTrans&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">TransitionObject</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span>
                                 <span class="n">reuseIndex</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">savePos</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="n">moment</span><span class="p">,</span>
                                 <span class="n">currentVolIndex</span><span class="o">=</span><span class="n">currentVolIndex</span><span class="p">,</span> <span class="n">altGraph</span><span class="o">=</span><span class="n">altGraph</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="n">pair</span><span class="p">,</span>
                                 <span class="n">dupRef</span><span class="o">=</span><span class="n">dupRef</span><span class="p">,</span> <span class="n">sadCOM</span><span class="o">=</span><span class="n">sadCOM</span><span class="p">,</span> <span class="n">sadMom</span><span class="o">=</span><span class="n">sadMom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="DefectVolumeObject.whichTrans"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.DefectVolumeObject.whichTrans">[docs]</a>    <span class="k">def</span> <span class="nf">whichTrans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ignoreFlag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all transitions which have the same final state as given.</span>
<span class="sd">        Used for build connectivities of a superbasin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lattice : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about the system.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the system.</span>
<span class="sd">        ignoreFlag : bool, optional</span>
<span class="sd">            * If False: only check transitions with flag 1 or 2 (Basin event/Potential basin event);</span>
<span class="sd">            * If True: check all transitions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        transNum : list</span>
<span class="sd">            Indexes of transitions stored in `self.transitions`.</span>

<span class="sd">        TODO: remove redundant method?</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling whichTrans&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">chosenHashkey</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span>
        <span class="n">chosenCOM</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">com</span>
        <span class="n">chosenMoment</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>
        <span class="n">transNum</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># store defects in current dv</span>
        <span class="n">NDefects</span><span class="p">,</span> <span class="n">vacancies</span><span class="p">,</span> <span class="n">interstitials</span><span class="p">,</span> <span class="n">antisites</span><span class="p">,</span> <span class="n">onAntisites</span><span class="p">,</span> <span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
            <span class="n">transIJK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">flag</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ignoreFlag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">chosenHashkey</span> <span class="o">==</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalHashkey</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chosenCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">finalCOM</span><span class="p">,</span> <span class="n">chosenCOM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">chosenMoment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="n">chosenMoment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                    <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># check duplicate info</span>
                    <span class="n">dupflag</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">chosenHashkey</span> <span class="o">==</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">kk</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">chosenCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">chosenCOM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">chosenMoment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">chosenMoment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                            <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                                            <span class="n">dupflag</span> <span class="o">=</span> <span class="mi">1</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                                        <span class="n">dupflag</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                                <span class="n">dupflag</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">dupflag</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="c1"># check defects and sep of dv</span>
                    <span class="k">elif</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">NDefects</span> <span class="o">==</span> <span class="n">NDefects</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">NDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">NDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">vacancies</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">interstitials</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">antisites</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">antisites</span><span class="p">):</span>

                            <span class="c1"># no need to compare positions of vacancies and antisites (these are reference positions), only check interstitials.</span>
                            <span class="n">pos1</span> <span class="o">=</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">defectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)))]</span>
                            <span class="n">pos2</span> <span class="o">=</span> <span class="n">defectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)))]</span>
                            <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrUniqueMinSep</span><span class="p">:</span>

                                <span class="n">graphList</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">graphVol</span><span class="p">,</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span>
                                <span class="n">pos1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                                <span class="n">pos2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">)):</span>
                                    <span class="n">jj</span> <span class="o">=</span> <span class="n">graphList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="p">]</span>
                                        <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

                                        <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))]</span>
                                        <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                                    <span class="k">except</span><span class="p">:</span>
                                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention(trans): Atom </span><span class="si">%d</span><span class="s2"> not in list&quot;</span><span class="o">%</span><span class="n">jj</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

                                <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Sep check </span><span class="si">%lf</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sep</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrUniqueMinSep</span><span class="p">:</span>
                                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention: basin states with diff hashkeys(Trans)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

                                    <span class="n">transIJK</span><span class="o">.</span><span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chosenHashkey</span><span class="p">)</span>
                                    <span class="n">transIJK</span><span class="o">.</span><span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chosenCOM</span><span class="p">)</span>
                                    <span class="n">transIJK</span><span class="o">.</span><span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chosenMoment</span><span class="p">)</span>
                                    <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">transNum</span></div></div>


<div class="viewcode-block" id="BasinObject"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject">[docs]</a><span class="k">class</span> <span class="nc">BasinObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The `BasinObject` class holds information about a superbasin.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    KMCRunner : `KMC.KMCRunner` object</span>
<span class="sd">        We need some information/methods from this object.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    defectVolumes : list</span>
<span class="sd">        List of `DefectVolumeObject` objects, holds information about all basin states in this superbasin.</span>
<span class="sd">    connectivity : list (2D matrix)</span>
<span class="sd">        Hold information about the connectivity within this superbasin.</span>
<span class="sd">    params : `Input.InputParams` object</span>
<span class="sd">        This object contains all parameters which are read from ``lkmcInput.IN`` by default.</span>
<span class="sd">    cellDims : ndarray</span>
<span class="sd">        Cell dimensions of the system. Used for PBC.</span>
<span class="sd">    pointer : list of integer</span>
<span class="sd">        Store the start/end point for each basin state.</span>
<span class="sd">        e.g. For a superbasin with three basin states, which, respectively, have 3,4,5 transitions.</span>
<span class="sd">        The pointer will be [0,3,7,12].</span>
<span class="sd">    currentDV : integer</span>
<span class="sd">        The index of basin state where the system currently is.</span>
<span class="sd">    currentTrans : integer</span>
<span class="sd">        The index of transition which has been chosen in the last step.</span>
<span class="sd">    previousDV : integer</span>
<span class="sd">        The index of basin state where the system is on previous step.</span>
<span class="sd">        This is a backup for previous `currentDV`. `currentDV` will fall back to this value</span>
<span class="sd">        if we failed to perform chosen transitions in the superbasin in current step.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">KMCRunner</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span> <span class="o">=</span> <span class="n">KMCRunner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">currentState</span><span class="o">.</span><span class="n">cellDims</span>
        <span class="c1">#pointer, store start point for each DV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#current defect volume&#39;s index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#the index of transition that has been chosen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#a flag indicate whether it&#39;s a newly builded basin in buildReverseTransitoins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newInBuildRev</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="BasinObject.createDV"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.createDV">[docs]</a>    <span class="k">def</span> <span class="nf">createDV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and store a new basin states into the superbasin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lattice : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about the system.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the system.</span>
<span class="sd">        currentDV : interger</span>
<span class="sd">            Specify the current defect volume of the basin.</span>
<span class="sd">            If None is given, we assume that the new DV to be its current.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling createDV&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DefectVolumeObject</span><span class="p">(</span><span class="n">lattice</span><span class="o">=</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">BasinObject</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Adding a DV to a basin whose currentDV is None. Setting currentDV to 0.&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;(WARNING: If you see the above message when this is not a new basin, you may have a serious problem.)&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="BasinObject.whichDV"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.whichDV">[docs]</a>    <span class="k">def</span> <span class="nf">whichDV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">createFlag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">explored</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debugMode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the basin state which has the same defect volume as given.</span>
<span class="sd">        Used for build connectivities of a superbasin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lattice : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about the system.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the system.</span>
<span class="sd">        createFlag : bool, optional</span>
<span class="sd">            * If True: If the given state is not found in stored basin states, create one for it.</span>
<span class="sd">        explored : bool, optional</span>
<span class="sd">            * If True: only check explored basin states.</span>
<span class="sd">        i : ingeter (DV index)</span>
<span class="sd">            If None (default), we use the basin&#39;s current defect volume. The user can specify a diffent defect volume to consider, as per their requirements.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DVNum : integer</span>
<span class="sd">            Index of basin state stored in `self.defectVolumes`.</span>
<span class="sd">        dupFlag : bool</span>
<span class="sd">            * If True: The basin state found have different hashkey form the given one,</span>
<span class="sd">              but they are identical defect volumes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling whichDV&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Fix broken currentDV</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;This basin&#39;s current defect volume is None. Attempt to fix from the map.&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">map</span><span class="p">)):</span>
                <span class="nb">print</span> <span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">map</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">tempBasinRef</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;This basin&#39;s current defect volume was None, found </span><span class="si">%r</span><span class="s2"> in map&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">tempBasinRef</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">break</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Could not fix current defect volume from map.&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Looking for current DV in the KMC current state via COM and moment.&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                <span class="n">csDV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                    <span class="n">bDV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">csDV</span><span class="o">.</span><span class="n">graphKey</span> <span class="o">==</span> <span class="n">bDV</span><span class="o">.</span><span class="n">hashkey</span> <span class="ow">or</span> <span class="n">csDV</span><span class="o">.</span><span class="n">graphKey</span> <span class="ow">in</span> <span class="n">bDV</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">csDV</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="n">bDV</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">csDV</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="n">bDV</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="n">d</span>
                                <span class="k">break</span>
                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bDV</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">csDV</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="n">bDV</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">csDV</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="n">bDV</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="n">d</span>
                                    <span class="k">break</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Found </span><span class="si">%r</span><span class="s2"> in KMC current state. Updating current defect volume.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinReport</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;The basin&#39;s current defect volume could not be found in KMC current state.&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Therefore this basin is not currently in use -- resetting its current defect volume to 0&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: Unused basins will results in undefined behavior!&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># if i is None and self.currentDV is None:</span>
        <span class="c1">#     log(__name__, &quot;ERROR: Could not fix this basin&#39;s current defect volume!&quot;, 1, 0)</span>
        <span class="c1">#     self.KMCRunner.basinReport(error=3)</span>
        <span class="c1">#     raise RuntimeError(&quot;\nwhichDV was called on a basin whose current defect volume was unassigned and could not be fixed.&quot;)</span>
        <span class="c1"># elif self.currentDV is None:</span>
        <span class="c1">#     log(__name__, &quot;whichDV was called on a basin whose current defect volume was unassigned and could not be fixed.&quot;, 2, 0)</span>

        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;The currentDV of this basin has index </span><span class="si">%r</span><span class="s2"> and has the primary hashkey, </span><span class="si">%r</span><span class="s2">. This basin contains </span><span class="si">%d</span><span class="s2"> defect volumes.&quot;</span><span class="o">%</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">hashkey</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span>
        <span class="n">COM</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">com</span>
        <span class="n">moment</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>

        <span class="c1"># if the given DV is a duplicate basin state, return dupFlag</span>
        <span class="n">dupFlag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># store defects in current dv</span>
        <span class="k">if</span> <span class="n">debugMode</span><span class="p">:</span>
            <span class="n">NDefects</span> <span class="o">=</span> <span class="n">vacancies</span> <span class="o">=</span> <span class="n">interstitials</span> <span class="o">=</span> <span class="n">antisites</span> <span class="o">=</span> <span class="n">onAntisites</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">NDefects</span><span class="p">,</span> <span class="n">vacancies</span><span class="p">,</span> <span class="n">interstitials</span><span class="p">,</span> <span class="n">antisites</span><span class="p">,</span> <span class="n">onAntisites</span><span class="p">,</span> <span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span>

        <span class="n">DVi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># skip if not basin state is not explored</span>
        <span class="k">if</span> <span class="n">explored</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">DVi</span><span class="o">.</span><span class="n">explored</span><span class="p">:</span>
            <span class="c1"># continue</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;The given defect volume is not explored. Since, this search is restricted to explored states, no match is returned.&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">False</span>

        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Trying hashkey </span><span class="si">%s</span><span class="s2"> with basin defect volume with primary hashkey, </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hashkey</span><span class="p">,</span><span class="n">DVi</span><span class="o">.</span><span class="n">hashkey</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">):</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;This basin DV also has the duplicate hashkeys:&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">)):</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">d</span><span class="p">],</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># if self.params.verboseLevel &gt; 1:</span>
            <span class="c1">#     print &quot;&quot;</span>

        <span class="k">if</span> <span class="n">DVi</span><span class="o">.</span><span class="n">hashkey</span> <span class="o">==</span> <span class="n">hashkey</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">COM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">COM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="n">COM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="n">moment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Positive (primary) match made on the basis of hashkey, centre of mass, and moment&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Positive (primary) match made on the basis of hashkey and centre of mass.&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;(Could not proceed to moment comparison, as one of the test defect volumes has </span><span class="se">\&quot;</span><span class="s2">None</span><span class="se">\&quot;</span><span class="s2"> assigned.)&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Positive (primary) match made on the basis of hashkey.&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;(Could not proceed to centre of mass comparison as of test defect volumes has </span><span class="se">\&quot;</span><span class="s2">None</span><span class="se">\&quot;</span><span class="s2"> assigned.)&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Hashkeys do not match: Hashkey1: </span><span class="si">%s</span><span class="s2">, Hashkey2: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,</span> <span class="n">hashkey</span><span class="p">)</span>
            <span class="c1"># check duplicate info</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">==</span> <span class="n">hashkey</span><span class="p">:</span>
                    <span class="n">dupFlag</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">COM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">COM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">moment</span><span class="p">,</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Positive (duplicate) match made on the basis of hashkey, centre of mass, and moment&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                                    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Positive (duplicate) match made on the basis of hashkey and centre of mass.&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;(Could not proceed to moment comparison, as one of the test defect volumes has </span><span class="se">\&quot;</span><span class="s2">None</span><span class="se">\&quot;</span><span class="s2"> assigned.)&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                                <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Positive (duplicate) match made on the basis of hashkey.&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;(Could not proceed to centre of mass comparison as of test defect volumes has </span><span class="se">\&quot;</span><span class="s2">None</span><span class="se">\&quot;</span><span class="s2"> assigned.)&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">False</span>

            <span class="c1"># check defects and sep of DV</span>
            <span class="k">if</span> <span class="n">DVi</span><span class="o">.</span><span class="n">NDefects</span> <span class="o">==</span> <span class="n">NDefects</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">NDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">NDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Hashkeys do not match. Comparing defects.&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">vacancies</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">interstitials</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">antisites</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">antisites</span><span class="p">):</span>
                    <span class="c1"># no need to compare positions of vacancies and antisites (these are reference positions), only check interstitials.</span>
                    <span class="n">pos1</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">defectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)))]</span>
                    <span class="n">pos2</span> <span class="o">=</span> <span class="n">defectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)))]</span>
                    <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrUniqueMinSep</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Defects match. Look at graph atoms now.&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">graphList</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">graphVol</span><span class="p">,</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span>
                        <span class="n">pos1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                        <span class="n">pos2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">)):</span>
                            <span class="n">jj</span> <span class="o">=</span> <span class="n">graphList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="p">]</span>
                                <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

                                <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))]</span>
                                <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention(DV): atom </span><span class="si">%d</span><span class="s2"> not in list&quot;</span><span class="o">%</span><span class="n">jj</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

                        <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Sep check </span><span class="si">%lf</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sep</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrUniqueMinSep</span><span class="p">:</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention: basin states with diff hashkeys(DV) </span><span class="si">%r</span><span class="s2">-</span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hashkey</span><span class="p">,</span> <span class="n">DVi</span><span class="o">.</span><span class="n">hashkey</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                            <span class="n">dupFlag</span> <span class="o">=</span> <span class="kc">True</span>

                            <span class="c1"># add state as a duplicate</span>
                            <span class="n">DVi</span><span class="o">.</span><span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashkey</span><span class="p">)</span>
                            <span class="n">DVi</span><span class="o">.</span><span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">COM</span><span class="p">)</span>
                            <span class="n">DVi</span><span class="o">.</span><span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moment</span><span class="p">)</span>
                            <span class="n">DVi</span><span class="o">.</span><span class="n">dupVolAtoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span>
                            <span class="n">vaPos</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)):</span>
                                <span class="n">vaPos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="p">])</span>
                                <span class="n">vaPos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">vaPos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
                            <span class="n">DVi</span><span class="o">.</span><span class="n">dupPos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vaPos</span><span class="p">)</span>

                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Positive (duplicate) match made on the basis of defect count and defect positions.&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Graph atoms do not match.&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Defects differ by </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">sep</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Number of individual defects types differ.&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">createFlag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createDV</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;This defect volume is not currently part of this basin as either a primary or duplicate. Adding it now.&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;The given defect volume is neither a primary nor duplicate state within this basin. Returning with no match&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="BasinObject.createTrans"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.createTrans">[docs]</a>    <span class="k">def</span> <span class="nf">createTrans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DVNum</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span>
                    <span class="n">reuseIndex</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savePos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">altGraph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a transition associated with the given basin state.</span>
<span class="sd">            * If already stored, pass;</span>
<span class="sd">            * If not stored, create a `TransitionObject` object and store it.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        DVNum : integer</span>
<span class="sd">            The index of basin state in the superbasin to be associated with the transition.</span>
<span class="sd">        barrier : float</span>
<span class="sd">            The (forward) barrier of the transition.</span>
<span class="sd">        reverseBarrier : float</span>
<span class="sd">            The backward (reverse) barrier of the transition.</span>
<span class="sd">        rate : float</span>
<span class="sd">            The original (uncorrected) rate of the transition.</span>
<span class="sd">        finalHashkey : string</span>
<span class="sd">            The (primary) hashkey of the final state of the transition.</span>
<span class="sd">        finalCOM : ndarray</span>
<span class="sd">            The (primary) Center Of Mass of the final state of the transition.</span>
<span class="sd">        reuseIndex : integer</span>
<span class="sd">            The index of transitions in the Volume file.</span>
<span class="sd">            i.e. where does this transition save in the Volume file.</span>
<span class="sd">        flag : integer</span>
<span class="sd">            * If 0 : ordinary event;</span>
<span class="sd">            * If 1 : potential basin event;</span>
<span class="sd">            * If 2 : basin event.</span>
<span class="sd">        finalDV : integer, optional</span>
<span class="sd">            The index of basin state where the final state of the transition pointed.</span>
<span class="sd">            i.e. the connection between basin states.</span>
<span class="sd">        final : `Lattice.Lattice` object, optional</span>
<span class="sd">            The object holds information of the final state of the transition.</span>
<span class="sd">        index : integer, optional</span>
<span class="sd">            The finalVolIndex in the list of defectVolumes of the final state of the transition.</span>
<span class="sd">            This might different from the currentVolIndex.</span>
<span class="sd">        savePos : bool, optional</span>
<span class="sd">            * If True : (default, only if `final` object is given) Store information about the defect volume atoms.</span>
<span class="sd">        moment : ndarray, optional</span>
<span class="sd">            The (primary) Moment of the final state of the transition.</span>
<span class="sd">        currentVolIndex : integer, optional</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the initial state of the transtion.</span>
<span class="sd">            i.e. the index of current working volume.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : integer</span>
<span class="sd">            * If 0 : successfully create and store the transition;</span>
<span class="sd">            * If 1 : cannot store the transition due to already stored.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling createTrans&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">DVNum</span><span class="p">]</span><span class="o">.</span><span class="n">createTrans</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span>
                                                     <span class="n">reuseIndex</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">savePos</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="n">moment</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="n">currentVolIndex</span><span class="p">,</span> <span class="n">altGraph</span><span class="o">=</span><span class="n">altGraph</span><span class="p">)</span></div>


<div class="viewcode-block" id="BasinObject.buildConnectivity"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.buildConnectivity">[docs]</a>    <span class="k">def</span> <span class="nf">buildConnectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the connectivity within the superbasin. Used for find pathways while perform transition in the superbasin and mean rate calculation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Building a basin&#39;s connectivity (buildConnectivity method).&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># sys.exit(&quot;Stoping for debug reasons&quot;)</span>

        <span class="n">DVNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[[[]</span> <span class="k">for</span> <span class="n">tmpi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">)]</span> <span class="k">for</span> <span class="n">tmpj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thisStateHashKey</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
            <span class="n">DVi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">transitions</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                <span class="n">Transij</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="c1">#Search for all B event, check if finalDV exist</span>
                <span class="k">if</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">&gt;=</span> <span class="n">DVNum</span><span class="p">:</span> <span class="c1"># -1: # Removed &quot;-1&quot;; doesn&#39;t make sense to me.</span>
                    <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;NOTE: buildConnectivity is changing the finalDV of transition </span><span class="si">%d</span><span class="s2"> of defect volume </span><span class="si">%d</span><span class="s2"> in this basin from </span><span class="si">%r</span><span class="s2"> to None&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

                <span class="c1"># Search for all P event, check if it&#39;s a B event or not. Check whether finals of P event are in the basin or not.</span>
                <span class="k">if</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lattice</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyLatticeBasin</span><span class="p">(</span><span class="n">Transij</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                        <span class="n">index</span><span class="p">,</span> <span class="n">dupFlag</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">whichDV</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">vol</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUG: Build connectivity, found DV from whichDV, Index: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">partOfPair</span><span class="p">:</span>
                        <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;NOTE: buildConnectivity is changing the finalDV of transition </span><span class="si">%d</span><span class="s2"> of defect volume </span><span class="si">%d</span><span class="s2"> in this basin from </span><span class="si">%r</span><span class="s2"> to </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">=</span> <span class="n">index</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="c1"># double check connectivity stored</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
            <span class="n">volumeI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">volumeI</span><span class="o">.</span><span class="n">transitions</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">volumeI</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                <span class="n">transIJ</span> <span class="o">=</span> <span class="n">volumeI</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">transIJ</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">transIJ</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">transIJ</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">transIJ</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">transIJ</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">transIJ</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">transIJ</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Basin connectivity matrix:&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> defect volumes&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;[ &quot;</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;- &quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;]&quot;</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1">#check if the connectivity matrix is symmetric</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">i</span><span class="p">):</span>
<span class="c1">#                 if self.defectVolumes[i].explored and self.defectVolumes[j].explored:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: Connectivity not symmetric! [</span><span class="si">%d</span><span class="s2">][</span><span class="si">%d</span><span class="s2">] has </span><span class="si">%d</span><span class="s2"> Trans and reverse has </span><span class="si">%d</span><span class="s2">!&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])),</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: Connectivity not symmetric! [</span><span class="si">%d</span><span class="s2">][</span><span class="si">%d</span><span class="s2">] has </span><span class="si">%d</span><span class="s2"> Trans and reverse has </span><span class="si">%d</span><span class="s2">!&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])),</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="BasinObject.shortestPath"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.shortestPath">[docs]</a>    <span class="k">def</span> <span class="nf">shortestPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the shortest pathway from the starting basin state to the ending basin state by using the Dijkstra&#39;s algorithm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : integer</span>
<span class="sd">            Index of the starting basin state in `self.defectVolumes`.</span>
<span class="sd">        end : integer</span>
<span class="sd">            Index of the ending basin state in `self.defectVolumes`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        S : list</span>
<span class="sd">            The pathway from start to end.</span>
<span class="sd">            *Notes* :</span>
<span class="sd">                * If return empty list : there&#39;s no path from start to end;</span>
<span class="sd">                * If the start == end : return a list with a single point;</span>
<span class="sd">                * If start == -1 : start = last DV.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling shortestPath&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buildConnectivity</span><span class="p">()</span>
        <span class="c1">#initializations</span>
        <span class="n">DVNo</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)</span>
        <span class="c1">#all nodes in the graph</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNo</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#Check start and end within basin:</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Q</span> <span class="ow">or</span> <span class="n">end</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;ERROR: start(</span><span class="si">%d</span><span class="s2">) or end(</span><span class="si">%d</span><span class="s2">) are out of range (0..</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">DVNo</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1">#Special case! start=end</span>
        <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>

        <span class="c1">#unknown distance from start</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">*</span> <span class="n">DVNo</span>
        <span class="c1">#previous node in optimal path from start</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">DVNo</span>
        <span class="c1">#distance from start to start</span>
        <span class="n">dist</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#main loop</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dist2</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
                <span class="n">dist2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1">#source node in first case</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">dist2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="n">dist2</span><span class="p">))]</span>
            <span class="k">del</span> <span class="n">Q</span><span class="p">[</span><span class="n">Q</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span>

            <span class="c1">#have found shortest path between start and end</span>
            <span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="c1">#all remaining vertices are inaccessible from source</span>
            <span class="k">if</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
                 <span class="c1">#check if u,v is connected</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">alt</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">alt</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]:</span>
                        <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">alt</span>
                        <span class="n">previous</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>

        <span class="c1">#list of shortest path from start to end</span>
        <span class="n">S</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">end</span>
        <span class="c1">#construct the shortest path with a stack S</span>
        <span class="k">while</span> <span class="n">previous</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
            <span class="c1">#traverse from end to start</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">previous</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="c1">#insert start only if there is a path</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">S</span></div>

<div class="viewcode-block" id="BasinObject.performTranslation"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.performTranslation">[docs]</a>    <span class="k">def</span> <span class="nf">performTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform transitions between basin states within the superbasin.</span>
<span class="sd">        i.e. perform series of refinements within the superbasin such that the current working basin state</span>
<span class="sd">        is transformed from ``start`` to ``end``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : integer</span>
<span class="sd">            Index of the starting basin state in `self.defectVolumes`.</span>
<span class="sd">        end : integer</span>
<span class="sd">            Index of the ending basin state in `self.defectVolumes`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : integer</span>
<span class="sd">            * If 0 : success</span>
<span class="sd">            * else : error</span>
<span class="sd">        currentState : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about the lattice at the ``end`` basin state.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling performTranslation&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="n">status</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">currentState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">currentState</span>
        <span class="n">refState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">refState</span>
        <span class="n">defectVolumes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">defectVolumes</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">verboseLevel</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;The KMC object&#39;s currentState&#39;s defectVolumeKeys are&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumesKeys</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortestPath</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Perform transitions within the basin, pathway of length </span><span class="si">%d</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">path</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Path hashkeys&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ph</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="n">ph</span><span class="p">]]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1">#no path</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;ERROR: There is no path from current defect volume#(</span><span class="si">%d</span><span class="s2">) to DV#(</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;ERROR: There is no path from current defect volume#(</span><span class="si">%d</span><span class="s2">) to DV#(</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Target defect volume is current DV&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">currentState</span>
        <span class="c1">#transition</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">localStart</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">localEnd</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">transNo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">localStart</span><span class="p">][</span><span class="n">localEnd</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">transNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">transNo</span><span class="p">]</span><span class="o">.</span><span class="n">reuseIndex</span>
                <span class="n">idv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span>
                <span class="n">iTrans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">transNo</span><span class="p">]</span>

                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;localStart = </span><span class="si">%d</span><span class="s2">, currentDV = </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">localStart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;transNo = </span><span class="si">%d</span><span class="s2">, transNum = </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">transNo</span><span class="p">,</span> <span class="n">transNum</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;The hashkeys are </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2"> (should be the same).&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;localEnd = </span><span class="si">%d</span><span class="s2">, hashkey </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">localEnd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localEnd</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="c1"># check for duplicates in path</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localEnd</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localEnd</span><span class="p">]</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localEnd</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Duplicate hashkeys within pathway&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">):</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;localStart has the following duplicate keys:&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">)):</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;localStart has no duplicate keys&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">transitions</span> <span class="o">=</span> <span class="n">defectVolumes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">]</span>
                        <span class="n">transHash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Transition is from primary hashkey </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,),</span> <span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">transitions</span> <span class="o">=</span> <span class="n">defectVolumes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span><span class="p">]]</span>
                        <span class="n">transHash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span><span class="p">]</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Transition is from duplicate (</span><span class="si">%d</span><span class="s2">) hashkey </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span><span class="p">],),</span> <span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;ERROR: Volume transitions </span><span class="si">%s</span><span class="s2"> not found in stored DVs.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,),</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

                <span class="n">transIniPos</span> <span class="o">=</span> <span class="n">transitions</span><span class="o">.</span><span class="n">initialPos</span>
                <span class="n">transSpecie</span> <span class="o">=</span> <span class="n">transitions</span><span class="o">.</span><span class="n">specie</span>
                <span class="n">transList</span> <span class="o">=</span> <span class="n">transitions</span><span class="o">.</span><span class="n">transitionList</span>

                <span class="nb">print</span> <span class="s2">&quot;DEBUG: number of transitions: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">transList</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">trns</span> <span class="ow">in</span> <span class="n">transList</span><span class="p">:</span>
                    <span class="c1"># is it always None here?</span>
                    <span class="k">if</span> <span class="n">trns</span><span class="o">.</span><span class="n">finalHashkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span> <span class="s2">&quot;DEBUG: transition final hashkey: &quot;</span><span class="p">,</span> <span class="n">trns</span><span class="o">.</span><span class="n">finalHashkey</span>

                <span class="c1"># check hashkeys for consistency</span>
                <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">cons</span> <span class="o">=</span> <span class="n">Graphs</span><span class="o">.</span><span class="n">consistentHashKeyCheck</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,</span><span class="n">transitions</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cons</span> <span class="o">=</span> <span class="n">Graphs</span><span class="o">.</span><span class="n">consistentHashKeyCheck</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span><span class="p">],</span><span class="n">transitions</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">cons</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">VTO in performTranslation has inconsistent hashkeys&quot;</span><span class="p">)</span>

                <span class="n">workingVol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">transNo</span><span class="p">]</span><span class="o">.</span><span class="n">currentVolIndex</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Debug 1: workingVol = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">workingVol</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">#               # check validity of workingVol.</span>
                <span class="k">if</span> <span class="n">workingVol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">workingVol</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">):</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;workingVol greater than number of defect volume in currentState&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">workingVol</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">elif</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span> <span class="ow">and</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Graphkey mismatch&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">verboseLevel</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="nb">print</span> <span class="s2">&quot;self.defectVolumes[localStart].hashkey&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span>
                            <span class="nb">print</span> <span class="s2">&quot;currentState.defectVolumes[workingVol].graphKey&quot;</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span>

                            <span class="nb">print</span> <span class="s2">&quot;Full list of currentState keys:&quot;</span>
                            <span class="k">for</span> <span class="n">ov</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                                <span class="nb">print</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">ov</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span>
                        <span class="n">workingVol</span> <span class="o">=</span> <span class="kc">None</span>


                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Debug 2: workingVol = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">workingVol</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="c1"># try to find the right workingVol</span>
                <span class="k">if</span> <span class="n">workingVol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1">#</span>
                    <span class="n">tmpList</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tmpList2</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Looking for matching hashkey in the (KMC) currentState&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">:</span>
                            <span class="n">tmpList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
                            <span class="c1">#</span>
                        <span class="k">elif</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">:</span>
                            <span class="n">tmpList2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Found non duplicate hashkey match&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">workingVol</span> <span class="o">=</span> <span class="n">tmpList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="c1">#</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">workingVol</span> <span class="o">=</span> <span class="n">tmpList2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Found duplicate hashkey match&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">COM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Mutiple hashkey matches found (</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmpList</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList2</span><span class="p">)),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Finding defect volume with matching hashkey with the smallest difference in COM&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">tmpListSep</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">tmpList</span><span class="p">:</span>
                                <span class="n">tmpListSep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">cellDims</span><span class="p">))</span>
                            <span class="c1">#</span>
                            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmpList2</span><span class="p">)):</span>
                                <span class="n">tmpListSep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">cellDims</span><span class="p">))</span>

                            <span class="n">tmpIndex</span> <span class="o">=</span> <span class="n">tmpListSep</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tmpListSep</span><span class="p">))</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Smallest separation is </span><span class="si">%f</span><span class="s2">, from index </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmpListSep</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tmpListSep</span><span class="p">)),</span> <span class="n">tmpIndex</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">tmpIndex</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList</span><span class="p">):</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Temp index is also a matching hashkey, so workingVol has been found.&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                                <span class="n">workingVol</span> <span class="o">=</span> <span class="n">tmpList</span><span class="p">[</span><span class="n">tmpIndex</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DV with smallest separation was not a matching hashkey&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#                                 tmpIndex -= len(tmpList)</span>
<span class="c1">#                                 workingVol = tmpList2(tmpIndex)</span>
<span class="c1">#                                 # refinement not working for dupHashkey</span>
<span class="c1">#                                 workingVol = None</span>


                <span class="k">if</span> <span class="n">workingVol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">NDefects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">NDefects</span>
                    <span class="c1"># vacancies = self.defectVolumes[localStart].vacancies</span>
                    <span class="c1"># interstitials = self.defectVolumes[localStart].interstitials</span>
                    <span class="c1"># antisites = self.defectVolumes[localStart].antisites</span>
                    <span class="c1"># onAntisites = self.defectVolumes[localStart].onAntisites</span>
                    <span class="n">defectPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">defectPos</span>
                    <span class="n">defectVolume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span>


                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Number of DVs in KMC currentState = </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="c1"># currentState.writeLattice(&quot;cs_%d.dat&quot; % (int(time.time())))</span>
                    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                        <span class="n">csdvii</span> <span class="o">=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                        <span class="n">csdviiNDefects</span><span class="p">,</span> <span class="n">csdviiVacancies</span><span class="p">,</span> <span class="n">csdviiInterstitials</span><span class="p">,</span> <span class="n">csdviiAntisites</span><span class="p">,</span> <span class="n">csdviiOnAntisites</span><span class="p">,</span> <span class="n">csdviiDefectPos</span> <span class="o">=</span> <span class="n">defectInfo</span><span class="p">(</span><span class="n">currentState</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">csdviiNDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">NDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">csdviiNDefects</span> <span class="o">==</span> <span class="n">NDefects</span><span class="p">:</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Comparing KMC currentState defect volume </span><span class="si">%d</span><span class="s2"> to localStart (Both have </span><span class="si">%d</span><span class="s2"> defects)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">NDefects</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="c1"># no need to compare positions of vacancies and antisites (these are reference positions), only check interstitials.</span>
                            <span class="n">posCS</span> <span class="o">=</span> <span class="n">csdviiDefectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">csdviiVacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csdviiVacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">csdviiInterstitials</span><span class="p">)))]</span>
                            <span class="n">posLS</span> <span class="o">=</span> <span class="n">defectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">csdviiVacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csdviiVacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">csdviiInterstitials</span><span class="p">)))]</span>
                            <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">posCS</span><span class="p">,</span> <span class="n">posLS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrUniqueMinSep</span><span class="p">:</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Passed first sep test&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

                                <span class="n">graphList</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">csdvii</span><span class="o">.</span><span class="n">graphVol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span>
                                <span class="n">posCS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                                <span class="n">posLS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">)):</span>
                                    <span class="n">jj</span> <span class="o">=</span> <span class="n">graphList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="n">posCS</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="p">]</span>
                                        <span class="n">posCS</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="n">posCS</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

                                        <span class="n">posLS</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">csdviiDefectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">csdvii</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))]</span>
                                        <span class="n">posLS</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">csdviiDefectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">csdvii</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="n">posLS</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">csdviiDefectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">csdvii</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;No problems with atom </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">jj</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                                    <span class="k">except</span><span class="p">:</span>
                                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention: Atom </span><span class="si">%d</span><span class="s2"> not in list&quot;</span><span class="o">%</span><span class="n">jj</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

                                <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">posCS</span><span class="p">,</span> <span class="n">posLS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Sep check </span><span class="si">%lf</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sep</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">barrUniqueMinSep</span><span class="p">:</span>
                                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention: basin states with diff hashkeys (csdvii)&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;(ie Passed second sep test)&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

                                    <span class="c1"># add as duplicate state</span>
                                    <span class="n">csdvii</span><span class="o">.</span><span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">)</span>
                                    <span class="n">csdvii</span><span class="o">.</span><span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">COM</span><span class="p">)</span>
                                    <span class="n">csdvii</span><span class="o">.</span><span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span><span class="p">)</span>
                                    <span class="n">csdvii</span><span class="o">.</span><span class="n">dupVolAtoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span>
                                    <span class="n">vaPos</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)):</span>
                                        <span class="n">vaPos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">])</span>
                                        <span class="n">vaPos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                                        <span class="n">vaPos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
                                    <span class="n">csdvii</span><span class="o">.</span><span class="n">dupPos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vaPos</span><span class="p">)</span>
                                    <span class="n">workingVol</span> <span class="o">=</span> <span class="n">ii</span>

                                    <span class="k">break</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Not matching DVs, first separation = </span><span class="si">%lf</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sep</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Could not compare: csdviiNDefects = </span><span class="si">%d</span><span class="s2">. NDefects = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">csdviiNDefects</span><span class="p">,</span> <span class="n">NDefects</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">workingVol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;No match&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Debug 3: workingVol = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">workingVol</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">workingVol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;performTranslation: returning </span><span class="se">\&#39;</span><span class="s2">status = 1, workingVol = None</span><span class="se">\&#39;</span><span class="s2"> because the working volume could not be found.&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

                <span class="n">graphVolume</span> <span class="o">=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>
                <span class="n">currentState</span><span class="o">.</span><span class="n">currentDefectVolume</span> <span class="o">=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span>

                <span class="n">newHashkey</span> <span class="o">=</span> <span class="n">Graphs</span><span class="o">.</span><span class="n">getHashKeyForAVolume</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">graphVolume</span><span class="p">,</span> <span class="n">currentState</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">newHashkey</span> <span class="o">!=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;performTranslation: ERROR currentState[workingVol] hashkey has changed! </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">newHashkey</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

                <span class="c1"># check if current volume is correct volume for transition</span>
                <span class="n">trans</span> <span class="o">=</span> <span class="n">transList</span><span class="p">[</span><span class="n">transNum</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">transHash</span> <span class="o">!=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;performTranslation: Transition initial hashkey differs from current state hashkey: </span><span class="si">%r</span><span class="s2"> and </span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">transHash</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

                    <span class="c1"># change graphVolume accordingly</span>
                    <span class="k">if</span> <span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">graphVolume</span> <span class="o">=</span> <span class="n">idv</span><span class="o">.</span><span class="n">graphVol</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;performTranslation: corrected graphVolume to primary graph atoms&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">graphVolume</span> <span class="o">=</span> <span class="n">idv</span><span class="o">.</span><span class="n">dupVolAtoms</span><span class="p">[</span><span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span><span class="p">]</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;performTranslation: corrected graphVolume to duplicate </span><span class="si">%d</span><span class="s2"> graph atoms&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Correting atom positions&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="n">idv</span><span class="o">.</span><span class="n">dvPos</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="n">idv</span><span class="o">.</span><span class="n">dupPos</span><span class="p">[</span><span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graphVolume</span><span class="p">)):</span>
                        <span class="n">atom</span> <span class="o">=</span> <span class="n">graphVolume</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                        <span class="nb">print</span> <span class="s2">&quot;correcting:&quot;</span><span class="p">,</span> <span class="n">iTrans</span><span class="o">.</span><span class="n">dupRef</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">currentState</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">atom</span><span class="p">]</span>   <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="p">]</span>
                        <span class="n">currentState</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">atom</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">currentState</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">atom</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

                    <span class="c1"># check corrected volume is correct</span>
                    <span class="n">newHashkey</span> <span class="o">=</span> <span class="n">Graphs</span><span class="o">.</span><span class="n">getHashKeyForAVolume</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">graphVolume</span><span class="p">,</span> <span class="n">currentState</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">newHashkey</span> <span class="o">!=</span> <span class="n">transHash</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;performTranslation: corrected volume does not match transition </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">newHashkey</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;performTranslation: Transition initial hashkey is the same as currentState: </span><span class="si">%r</span><span class="s2"> and </span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">transHash</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

                <span class="n">transitionRefiner</span> <span class="o">=</span> <span class="n">Refine</span><span class="o">.</span><span class="n">TransitionRefiner</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">refState</span><span class="p">)</span>
                <span class="n">transitionRefiner</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">currentState</span><span class="p">)</span>

                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Refinement for volume </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%d</span><span class="s2">) number </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,</span> <span class="n">workingVol</span><span class="p">,</span> <span class="n">transNum</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">newInputState</span><span class="p">,</span> <span class="n">resultInfo</span> <span class="o">=</span> <span class="n">transitionRefiner</span><span class="o">.</span><span class="n">refineFinalState</span><span class="p">(</span><span class="n">transIniPos</span><span class="p">,</span> <span class="n">transSpecie</span><span class="p">,</span> <span class="n">graphVolume</span><span class="p">,</span> <span class="n">volumeTransitionObject</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">newInputState</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;ERROR: Refinement failed.&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">currentState</span> <span class="o">=</span> <span class="n">newInputState</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">hashkey</span> <span class="ow">in</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumesKeys</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumesKeys</span><span class="p">)</span><span class="o">&amp;</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">performTranslation attempted to set currentDV to &#39;end&#39; but &#39;end&#39; is None&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="n">end</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Updating currentDV at end of performTranslation. New currentDV = </span><span class="si">%r</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">currentState</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;ERROR: Volume (</span><span class="si">%s</span><span class="s2">) not in final DV list.&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;No matches in dup and current two lists!&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUG: duplicate hashkey: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumesKeys</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUG: currentState hashkey: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                    <span class="c1"># if WVpos:</span>
                    <span class="c1">#     WVLattice.writeLattice(WVpath)</span>

                <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="BasinObject.meanRate"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.meanRate">[docs]</a>    <span class="k">def</span> <span class="nf">meanRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startDV</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Correct the rates for all transitions stored in the superbasin by using the Mean Rate Method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        startDV : integer, optional</span>
<span class="sd">            Index of basin state where the system entered the superbasin. Default: 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : list</span>
<span class="sd">            List of corrected rates for all transitions stored in the superbasin.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling meanRate&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1">#build connectivity to update flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buildConnectivity</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#         stateNum = len(self.defectVolumes)</span>
        <span class="c1"># number of explored states</span>
        <span class="n">stateNum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stateMapping</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">explored</span><span class="p">:</span>
                <span class="n">stateNum</span> <span class="o">=</span> <span class="n">stateNum</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">stateMapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DEBUGINFO: stateNum is </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%d</span><span class="s2">), stateMapping is </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">stateNum</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">),</span> <span class="n">stateMapping</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># for the case where the basin is newly built in buildReverseTrans, there are only two states and only one of them is explored. Return original rates</span>
        <span class="k">if</span> <span class="n">stateNum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">trans</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">transMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">stateNum</span><span class="p">,</span> <span class="n">stateNum</span><span class="p">])</span>

        <span class="c1">#mean residence time in state i each time it is visited</span>
        <span class="n">tao1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">stateNum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">transNum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">stateNum</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
            <span class="n">transNum</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">)</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transNum</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span>
            <span class="k">if</span> <span class="nb">sum</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Error: Sum of rates for State </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> trans) is zero!&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">transNum</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">tao1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">sum</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUGINFO: tao1 are&quot;</span><span class="p">,</span> <span class="n">tao1</span>
        <span class="c1">#if there is only one DV in the basin, return origin rates</span>
        <span class="k">if</span> <span class="n">stateNum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transNum</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">j</span><span class="p">]]:</span>

                    <span class="n">transMatrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tao1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUGINFO: TransMatrix is&quot;</span><span class="p">,</span> <span class="n">transMatrix</span>
        <span class="n">occupVect0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">stateNum</span><span class="p">)</span>
        <span class="n">occupVect0</span><span class="p">[</span><span class="n">startDV</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="n">matrix2bInv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">stateNum</span><span class="p">))</span> <span class="o">-</span> <span class="n">transMatrix</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">occupVect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">matrix2bInv</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Error: Transition Matrix not invertible.&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUGINFO: Inverted Matrix is &quot;</span><span class="p">,</span> <span class="n">occupVect</span>
        <span class="n">occupVect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">occupVect</span><span class="p">,</span> <span class="n">occupVect0</span><span class="p">)</span>
        <span class="n">occupVect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">occupVect</span><span class="p">))</span>

        <span class="c1"># mean residence time in basin state i before leaving the basin</span>
        <span class="n">tao</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">stateNum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">taoSum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
            <span class="n">tao</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tao1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">occupVect</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">taoSum</span> <span class="o">+=</span> <span class="n">tao</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="c1"># corrected rates</span>
        <span class="n">negRate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transNum</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>

                <span class="c1"># rate for a basin event: double check the ending dv not an unexplored basin state</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span><span class="o">.</span><span class="n">explored</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">localRate</span> <span class="o">=</span> <span class="n">tao</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">taoSum</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localRate</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">localRate</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: get a negative mean rate!! </span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">localRate</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">negRate</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUG: origin rates:&quot;</span><span class="p">,</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transNum</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">stateMapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span><span class="s2">&quot;)&quot;</span><span class="p">,</span>
            <span class="nb">print</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUG: mean rates:&quot;</span><span class="p">,</span><span class="n">result</span>

        <span class="k">if</span> <span class="n">negRate</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="BasinObject.integrityCheck"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.integrityCheck">[docs]</a>    <span class="k">def</span> <span class="nf">integrityCheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvi</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detect and correct any duplicate states that have gone undetected and erroneously saved.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dvi : int</span>
<span class="sd">            The state within the basin whose transitions will be checked.</span>
<span class="sd">            Defaults to the currentDV</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        correction : bool</span>
<span class="sd">        Returned as:</span>
<span class="sd">            * True if changes to the basin are made</span>
<span class="sd">            * False if not changes are made</span>
<span class="sd">            * None if integrityCheck cannot be performed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">correction</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dvi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dvi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;currentDV not assigned, cannot run integrityCheck!&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">correction</span>

        <span class="n">correction</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Identify any two defect volumes that are possible duplciates</span>
        <span class="n">possibleMatches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">dvi</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dv</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
            <span class="n">tT</span> <span class="o">=</span> <span class="n">dv</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tT</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tDV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">tT</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                    <span class="n">sT</span> <span class="o">=</span> <span class="n">dv</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">sT</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sT</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">!=</span> <span class="n">tT</span><span class="o">.</span><span class="n">finalDV</span><span class="p">:</span>
                        <span class="n">sDV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">sT</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span>
                        <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">tDV</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="n">sDV</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                            <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">tDV</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="n">sDV</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                <span class="n">possibleMatches</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">])</span>

        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;integrityCheck: possibleMatches:&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">possibleMatches</span><span class="p">)):</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;DV </span><span class="si">%d</span><span class="s2"> &amp; </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dv</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">finalDV</span><span class="p">,</span> <span class="n">dv</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">finalDV</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Make corrections</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">possibleMatches</span><span class="p">)):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">suspect</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">i</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">j</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Always remove the more recently added defect volume. Also allows one to more effriciently utilise whichDV.</span>
            <span class="k">if</span> <span class="n">dv</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">&gt;</span> <span class="n">dv</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">t</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">s</span>
                <span class="n">suspect</span> <span class="o">=</span> <span class="n">dv</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">s</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">t</span>
                <span class="n">suspect</span> <span class="o">=</span> <span class="n">dv</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

            <span class="n">lattice</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyLatticeBasin</span><span class="p">(</span><span class="n">suspect</span><span class="p">)</span>

            <span class="c1"># Search for the suspected duplicate state in the basin</span>
            <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                <span class="n">index</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">whichDV</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">vol</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="c1"># If the index differs from the finalDV, the two defect volumes found should be one state with a duplicate.</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="n">suspect</span><span class="o">.</span><span class="n">finalDV</span><span class="p">:</span>
                <span class="n">correction</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Found previously-missed duplicate to remove (DV </span><span class="si">%d</span><span class="s2"> is a duplicate of </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">suspect</span><span class="o">.</span><span class="n">finalDV</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">badDV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">suspect</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">badDV</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">badDV</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">!=</span> <span class="n">dvi</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: badDV (</span><span class="si">%d</span><span class="s2">) has transition (</span><span class="si">%d</span><span class="s2">) to non-dvi final (</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">suspect</span><span class="o">.</span><span class="n">finalDV</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">badDV</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Remove the separate defect volume.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">suspect</span><span class="o">.</span><span class="n">finalDV</span><span class="p">)</span>
                <span class="c1"># Remove erroneous transitions.</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                    <span class="c1"># Identify transitions to remove</span>
                    <span class="n">remove</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">==</span> <span class="n">suspect</span><span class="o">.</span><span class="n">finalDV</span><span class="p">:</span>
                            <span class="n">remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="c1"># Remove them</span>
                    <span class="n">removed</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">remove</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">remove</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">-</span><span class="n">removed</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">possibleMatches</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">remove</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">-</span><span class="n">removed</span><span class="p">:</span>
                                <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">remove</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">-</span><span class="n">removed</span><span class="p">:</span>
                                <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="n">removed</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Adjust indexes to account for the removal of a defect volume.</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">&gt;</span> <span class="n">suspect</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">-=</span> <span class="mi">1</span>

                <span class="c1"># Adjust possible matches to account for the removal of a defect volume.</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">possibleMatches</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">suspect</span><span class="o">.</span><span class="n">finalDV</span><span class="p">:</span>
                        <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">suspect</span><span class="o">.</span><span class="n">finalDV</span><span class="p">:</span>
                        <span class="n">possibleMatches</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">correction</span></div>


<div class="viewcode-block" id="BasinObject.write"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">outdir</span><span class="p">,</span> <span class="n">basinNo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the built superbasin into a file. Used for resuming an unfinished work.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            The name of the file to be written.</span>
<span class="sd">        outdir : string</span>
<span class="sd">            The location of the file to be written.</span>
<span class="sd">        basinNo : integer</span>
<span class="sd">            Index of the superbasin to be written.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling write&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># total line number for each basin: 6 + 16*DVNo + 23*TransNo</span>

        <span class="c1"># start sign</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&gt;!Basin</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">basinNo</span>

        <span class="c1">#1: pointer(length = volumeNum+1, last number = transNum)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1">#2: connectivity</span>
        <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">n1</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">n3</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">n1</span><span class="p">][</span><span class="n">n2</span><span class="p">])):</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">n1</span><span class="p">][</span><span class="n">n2</span><span class="p">][</span><span class="n">n3</span><span class="p">]</span>
                <span class="n">text</span> <span class="o">+=</span><span class="s2">&quot;;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1">#3-4 line: currentDV, previousDV</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span><span class="p">)</span>

        <span class="c1">#loop for all DVs</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
            <span class="n">volumeIJ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="c1"># start sign</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&gt;!DefectVol</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">j</span>

            <span class="c1">#0: explored</span>
            <span class="k">if</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">explored</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;1</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;0</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1">#1: hashkey</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">volumeIJ</span><span class="o">.</span><span class="n">hashkey</span>

            <span class="c1">#2: COM</span>
            <span class="k">if</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">COM</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">COM</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1">#3-4 primaryVol, graphVol</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">graphVol</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1">#5 dvPos &amp; dupPos</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dvPos</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">volumeIJ</span><span class="o">.</span><span class="n">dupPos</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dupPos</span><span class="p">[</span><span class="n">q</span><span class="p">]:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">p</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1">#6-9 vacancies, interstitials, antisites, onAntisites</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">vacancies</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">interstitials</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">antisites</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1">#10 defectPos</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">defectPos</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1">#11-15 moment, dupHashkey, dupCOM, dupMoment, dupVolAtoms</span>
            <span class="k">if</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">moment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">moment</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None &quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">q</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">q</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dupVolAtoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">q</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1">#loop for all trans</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">volumeIJ</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                <span class="n">transIJK</span> <span class="o">=</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                <span class="c1">#start sign</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&gt;!TransObj</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">k</span>

                <span class="c1">#1-4: barrier, reverseBarrier, rate, finalHashkey</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%lf</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">barrier</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalHashkey</span><span class="p">)</span>

                <span class="c1">#5: finalCOM, sadCOM, sadMom</span>
                <span class="k">if</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalCOM</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None None None &quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalCOM</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">sadCOM</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">sadMom</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="c1">#6-9: reuseIndex, flag, finalDV, currentVolIndex, finalVolIndex # IMPORTANT NONE - the current and final VolIndex count for ONE entry</span>
                <span class="c1"># text += &quot;%r\n%d\n%s\n%s\n&quot;%(transIJK.reuseIndex, transIJK.flag, transIJK.finalDV, transIJK.finalVolIndex) # original</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%r</span><span class="se">\n</span><span class="si">%d</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">reuseIndex</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalDV</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">currentVolIndex</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalVolIndex</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupRef</span><span class="p">)</span>

                <span class="c1">#10-17 primaryVol, graphVol, dvPos, vacancies, interstitials, antisites, onAntisites, defectPos</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">transIJK</span><span class="p">,</span> <span class="s2">&quot;primaryVol&quot;</span><span class="p">):</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">8</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#10-11 primaryVol, graphVol</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">graphVol</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                    <span class="c1">#12 dvPos</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dvPos</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                    <span class="c1">#13-16 vacancies, interstitials, antisites, onAntisites</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">interstitials</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">antisites</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                    <span class="c1">#17 defectPos</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">defectPos</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="c1">#18-21 moment, dupHashkey, dupCOM, dupMoment</span>
                <span class="k">if</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">moment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">moment</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None &quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">q</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">q</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="c1">#end sign</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&lt;!TransObj</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">k</span>
            <span class="c1">#end sign</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&lt;!DefectVol</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">j</span>
        <span class="c1">#end sign</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&lt;!Basin</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">basinNo</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">writer</span>
        <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outdir</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;append&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasinObject.read"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read information about the stored superbasin from a file. Create and store corresponding objects.</span>
<span class="sd">        Used form resuming an unfinished work.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : string</span>
<span class="sd">            Lines read from a file, which store informations about the superbasin.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1">#1 pointer</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span> <span class="o">=</span> <span class="n">pointer</span>
        <span class="n">DVNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pointer</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

        <span class="c1">#2 connectivity</span>
        <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="p">[[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">)]</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">readline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">DVNum</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>

        <span class="c1">#3-4 currentDV</span>
        <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Basin read from file has &#39;None&#39; as its currentDV.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#4 previousDV</span>
        <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># create DVs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
            <span class="c1"># check start sign</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&gt;!DefectVol&quot;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error start sign (DV) while reading basin file.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">11</span><span class="p">:])</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error DV number while reading basin file.&quot;</span><span class="p">)</span>

            <span class="n">dummyTrans</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyTrans</span><span class="p">()</span>

            <span class="c1">#0 explored // for compability, check whether we have this line</span>
            <span class="n">explored</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">explored</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span> <span class="ow">and</span> <span class="n">explored</span> <span class="o">!=</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                <span class="n">hashkey</span> <span class="o">=</span> <span class="n">explored</span>
                <span class="n">explored</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1">#1 hashkey</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hashkey</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">finalHashkey</span> <span class="o">=</span> <span class="n">hashkey</span>

            <span class="c1">#2 COM</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readline</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">COM</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">COM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">finalCOM</span> <span class="o">=</span> <span class="n">COM</span>

            <span class="c1">#3-4 primaryVol, graphVol</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">primaryVol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">primaryVol</span> <span class="o">=</span> <span class="n">primaryVol</span>

            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">graphVol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="n">graphVol</span>

            <span class="c1">#5 dvPos &amp; dupPos</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">dvPos</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
                <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dupPos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dvPos</span><span class="p">)</span>


            <span class="c1">#6-9 vacancies, interstitials, antisites, onAntisites</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">vacancies</span> <span class="o">=</span> <span class="n">vacancies</span>

            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">interstitials</span> <span class="o">=</span> <span class="n">interstitials</span>

            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">antisites</span> <span class="o">=</span> <span class="n">antisites</span>

            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">onAntisites</span> <span class="o">=</span> <span class="n">onAntisites</span>

            <span class="c1">#10 defectPos</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readline</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectPos</span>

            <span class="c1">#11-14 moment, dupHashkey, dupCOM, dupMoment</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">moment</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>

            <span class="n">dupHashkey</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                    <span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">p</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="nb">print</span> <span class="s2">&quot;DEBUG: dupHashkeys: &quot;</span><span class="p">,</span> <span class="n">p</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dupHashkey</span> <span class="o">=</span> <span class="n">dupHashkey</span>

            <span class="n">dupCOM</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                    <span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">q</span><span class="p">)))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dupCOM</span> <span class="o">=</span> <span class="n">dupCOM</span>

            <span class="n">dupMoment</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                    <span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">q</span><span class="p">)))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dupMoment</span> <span class="o">=</span> <span class="n">dupMoment</span>

            <span class="n">dupVolAtoms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                    <span class="n">dupVolAtoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dupVol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
                    <span class="n">dupVolAtoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupVol</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dupVolAtoms</span> <span class="o">=</span> <span class="n">dupVolAtoms</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUG: dupVolAtoms: &quot;</span><span class="p">,</span> <span class="n">dupVolAtoms</span>
            <span class="n">dummyLattice</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyLatticeBasin</span><span class="p">(</span><span class="n">dummyTrans</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DefectVolumeObject</span><span class="p">(</span><span class="n">dummyLattice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

            <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">explored</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">explored</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">explored</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">explored</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">explored</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1">#create transitions</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pointer</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pointer</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="c1"># check start sign</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&gt;!TransObj&quot;</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error start sign (Trans) while reading basin file.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">10</span><span class="p">:])</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error Trans number while reading basin file.&quot;</span><span class="p">)</span>

                <span class="n">dummyTrans</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyTrans</span><span class="p">()</span>
                <span class="c1">#1 barrier</span>
                <span class="n">barrier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="c1">#2 reverseBarrier</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">reverseBarrier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">reverseBarrier</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1">#3 rate</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="c1">#4 finalHashkey</span>
                <span class="n">finalHashkey</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">finalHashkey</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">):</span>
                    <span class="n">finalHashkey</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">dummyTrans</span><span class="o">.</span><span class="n">finalHashkey</span> <span class="o">=</span> <span class="n">finalHashkey</span>

                <span class="c1">#5 finalCOM, sadCOM, sadMom</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">finalCOM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">[:</span><span class="mi">3</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">finalCOM</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sadCOM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">sadCOM</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sadMom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">[</span><span class="mi">6</span><span class="p">:]))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">sadMom</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">dummyTrans</span><span class="o">.</span><span class="n">finalCOM</span> <span class="o">=</span> <span class="n">finalCOM</span>
                <span class="n">dummyTrans</span><span class="o">.</span><span class="n">sadCOM</span> <span class="o">=</span> <span class="n">sadCOM</span>
                <span class="n">dummyTrans</span><span class="o">.</span><span class="n">sadMom</span> <span class="o">=</span> <span class="n">sadMom</span>


                <span class="c1">#6-7 reuseIndex, flag</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">reuseIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">reuseIndex</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="c1">#8 finalDV</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">finalDV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">finalDV</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1">#9 currentVolIndex</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">currentVolIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">currentVolIndex</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">finalVolIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">finalVolIndex</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dupRef</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">dupRef</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1">#10-17 primaryVol, graphVol, dvPos, vacancies, interstitials, antisites, onAntisites, defectPos</span>
                <span class="n">savePos</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c1"># dvPos info stored?</span>
                <span class="k">if</span> <span class="n">readline</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">savePos</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
                        <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># primaryVol</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">readline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">primaryVol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">primaryVol</span> <span class="o">=</span> <span class="n">primaryVol</span>

                    <span class="c1">#graphVol</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">graphVol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="n">graphVol</span>

                    <span class="c1">#dvPos</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">dvPos</span>

                    <span class="c1">#vacancies, interstitials, antisites, onAntisites</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">vacancies</span> <span class="o">=</span> <span class="n">vacancies</span>

                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">interstitials</span> <span class="o">=</span> <span class="n">interstitials</span>

                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">antisites</span> <span class="o">=</span> <span class="n">antisites</span>

                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">onAntisites</span> <span class="o">=</span> <span class="n">onAntisites</span>

                    <span class="c1">#defectPos</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">readline</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>
                        <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectPos</span>

                <span class="k">if</span> <span class="n">savePos</span><span class="p">:</span>
                    <span class="n">dummyLattice</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyLatticeBasin</span><span class="p">(</span><span class="n">dummyTrans</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dummyLattice</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">createTrans</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span> <span class="n">reuseIndex</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="p">,</span>
                                   <span class="n">dummyLattice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">savePos</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="n">currentVolIndex</span><span class="p">,</span> <span class="n">dupRef</span><span class="o">=</span><span class="n">dupRef</span><span class="p">,</span>
                                   <span class="n">sadCOM</span><span class="o">=</span><span class="n">sadCOM</span><span class="p">,</span> <span class="n">sadMom</span><span class="o">=</span><span class="n">sadMom</span><span class="p">)</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">finalVolIndex</span> <span class="o">=</span> <span class="n">finalVolIndex</span>

                <span class="c1">#18-21 moment, dupHashkey, dupCOM, dupMoment</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">moment</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>

                <span class="n">dupHashkey</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                        <span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">p</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span> <span class="o">=</span> <span class="n">dupHashkey</span>

                <span class="n">dupCOM</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                        <span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                        <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">q</span><span class="p">)))</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dupCOM</span> <span class="o">=</span> <span class="n">dupCOM</span>

                <span class="n">dupMoment</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                        <span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                        <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">q</span><span class="p">)))</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dupMoment</span> <span class="o">=</span> <span class="n">dupMoment</span>

                <span class="c1"># check end sign</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&lt;!TransObj&quot;</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end sign (Trans) while reading basin file.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">10</span><span class="p">:])</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end Trans number while reading basin file.&quot;</span><span class="p">)</span>
            <span class="c1"># check end sign</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&lt;!DefectVol&quot;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end sign (DV) while reading basin file.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">11</span><span class="p">:])</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end DV number while reading basin file.&quot;</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="BasinObject.printout"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.printout">[docs]</a>    <span class="k">def</span> <span class="nf">printout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usually for debug use. Print out all information about the current superbasin.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span>
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling printout&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="mi">30</span>
        <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">),</span> <span class="s2">&quot;defectVolumes&quot;</span>
        <span class="nb">print</span> <span class="s2">&quot;currentDV: </span><span class="si">%s</span><span class="s2">, currentTrans: </span><span class="si">%s</span><span class="s2">, previousDV: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
            <span class="nb">print</span> <span class="s2">&quot;    #&quot;</span><span class="p">,</span><span class="n">i</span>
            <span class="nb">print</span> <span class="s2">&quot;    explored:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">explored</span>
            <span class="nb">print</span> <span class="s2">&quot;    hashkey:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span>
            <span class="nb">print</span> <span class="s2">&quot;    center of mass:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">COM</span>
            <span class="nb">print</span> <span class="s2">&quot;    moment:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>
            <span class="nb">print</span> <span class="s2">&quot;    &gt;dup hashkey:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span>
            <span class="nb">print</span> <span class="s2">&quot;    &gt;dup com:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dupCOM</span>
            <span class="nb">print</span> <span class="s2">&quot;    &gt;dup moment:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dupMoment</span>
            <span class="nb">print</span> <span class="s2">&quot;     DV atoms:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">primaryVol</span>
            <span class="nb">print</span> <span class="s2">&quot;     graph atoms:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>
            <span class="nb">print</span> <span class="s2">&quot;     vacancies:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">vacancies</span>
            <span class="nb">print</span> <span class="s2">&quot;     interstitials:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">interstitials</span>
            <span class="nb">print</span> <span class="s2">&quot;     antisites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">antisites</span>
            <span class="nb">print</span> <span class="s2">&quot;     onAntisites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">onAntisites</span>

            <span class="nb">print</span> <span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">),</span> <span class="s2">&quot;transitions&quot;</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                <span class="nb">print</span> <span class="s2">&quot;        ##&quot;</span><span class="p">,</span> <span class="n">j</span>
                <span class="nb">print</span> <span class="s2">&quot;        barrier:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">barrier</span>
                <span class="nb">print</span> <span class="s2">&quot;        reverse barrier:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">reverseBarrier</span>
                <span class="nb">print</span> <span class="s2">&quot;        rate:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span>
                <span class="nb">print</span> <span class="s2">&quot;        final hashkey:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalHashkey</span>
                <span class="nb">print</span> <span class="s2">&quot;        final center of mass:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalCOM</span>
                <span class="nb">print</span> <span class="s2">&quot;        final moment:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>
                <span class="nb">print</span> <span class="s2">&quot;        &gt;final dup hashkey:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span>
                <span class="nb">print</span> <span class="s2">&quot;        &gt;final dup com:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dupCOM</span>
                <span class="nb">print</span> <span class="s2">&quot;        &gt;final dup moment:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dupMoment</span>
                <span class="nb">print</span> <span class="s2">&quot;        reuse file index:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">reuseIndex</span>
                <span class="nb">print</span> <span class="s2">&quot;        flag:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span>
                <span class="nb">print</span> <span class="s2">&quot;        final DV:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span>
                <span class="nb">print</span> <span class="s2">&quot;        current volume index:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">currentVolIndex</span>
                <span class="nb">print</span> <span class="s2">&quot;        final volume index:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalVolIndex</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="s2">&quot;primaryVol&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;         DV atoms:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">primaryVol</span>
                    <span class="nb">print</span> <span class="s2">&quot;         graph atoms:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>
                    <span class="nb">print</span> <span class="s2">&quot;         vacancies:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">vacancies</span>
                    <span class="nb">print</span> <span class="s2">&quot;         interstitials:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">interstitials</span>
                    <span class="nb">print</span> <span class="s2">&quot;         antisites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">antisites</span>
                    <span class="nb">print</span> <span class="s2">&quot;         onAntisites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">onAntisites</span>

        <span class="nb">print</span> <span class="s2">&quot;connectivity:&quot;</span>
<span class="c1">#         print self.connectivity</span>
<span class="c1">#         print &quot;Testing formatted output&quot;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)):</span>
            <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[:][</span><span class="n">a</span><span class="p">]</span>
<span class="c1">#         print &quot;\nAlternatively&quot;</span>
<span class="c1">#         for a in xrange(len(self.connectivity)):</span>
<span class="c1">#             print self.connectivity[a][:]</span>
        <span class="nb">print</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="nb">print</span> <span class="s2">&quot;pointer:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span>

        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Exploration list:&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">explored</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="defectInfo"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.defectInfo">[docs]</a><span class="k">def</span> <span class="nf">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the information about defect atoms in a given defect volume.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : &#39;Lattice&#39; object</span>
<span class="sd">        The object holds information about the whole lattice</span>
<span class="sd">    index : integer</span>
<span class="sd">        The Volume Index in the list of defectVolumes of the lattice.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    NDefects : integer</span>
<span class="sd">        Number of atoms in the given defect volume.</span>
<span class="sd">    vacancies : ndarray</span>
<span class="sd">        Indexes of atoms (in the reference system) which are vacancies in the given defect volume.</span>
<span class="sd">    interstitials : ndarray</span>
<span class="sd">        Indexes of atoms (in the given lattice) which are interstitials in the given defect volume.</span>
<span class="sd">    antisites : ndarray</span>
<span class="sd">        Indexes of atoms (in the reference system) which are antisites in the given defect volume.</span>
<span class="sd">    onAntisites : ndarray</span>
<span class="sd">        Indexes of atoms (in the given lattice) which are onAntisites in the given defect volume.</span>
<span class="sd">    defectPos : ndarray</span>
<span class="sd">        Possitions of all defect atoms, in the order of vacancies, interstitials, onAntisites.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling defectInfo&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># store defects info in current dv</span>
    <span class="n">vacancies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">interstitials</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">antisites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">onAntisites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NDefects</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">NDefects</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">cluster</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">cluster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">NDefects</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NVac</span><span class="p">:</span>
                <span class="n">vacancies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">vacancies</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">vacPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">vacPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">vacPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NVac</span> <span class="o">+</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NInt</span><span class="p">):</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NVac</span>
                <span class="n">interstitials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">interstitials</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">intPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">intPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">intPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NVac</span> <span class="o">-</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NInt</span>
                <span class="n">antisites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">antisites</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">onAntisites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">onAntPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">onAntPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">onAntPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">defectPos</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">NDefects</span><span class="p">)</span>
    <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vacancies</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">interstitials</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">antisites</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">onAntisites</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">NDefects</span><span class="p">,</span> <span class="n">vacancies</span><span class="p">,</span> <span class="n">interstitials</span><span class="p">,</span> <span class="n">antisites</span><span class="p">,</span> <span class="n">onAntisites</span><span class="p">,</span> <span class="n">defectPos</span></div>

<div class="viewcode-block" id="writeBasin"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.writeBasin">[docs]</a><span class="k">def</span> <span class="nf">writeBasin</span><span class="p">(</span><span class="n">KMCRunner</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the built superbasins into a file. Used for resuming an unfinished work.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    KMCRunner : `KMC.KMCRunner` object</span>
<span class="sd">        We need some information/methods from this object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling writeBasin&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)):</span>
        <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">buildConnectivity</span><span class="p">()</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;basinList.bsn&quot;</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">searchResults</span><span class="o">.</span><span class="n">taskOutputDir</span>

    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Writing basin file </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">outdir</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">#first line: number of basin</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)</span>

    <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outdir</span><span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
    <span class="n">KMCRunner</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1">#loop for all basins</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)):</span>
        <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">outdir</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></div>

<div class="viewcode-block" id="readBasin"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.readBasin">[docs]</a><span class="k">def</span> <span class="nf">readBasin</span><span class="p">(</span><span class="n">KMCRunner</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read information about the stored superbasin from a file. Create and store corresponding objects.</span>
<span class="sd">    Used form resuming an unfinished work.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    KMCRunner : `KMC.KMCRunner` object</span>
<span class="sd">        We need some information/methods from this object.</span>
<span class="sd">    filename : string</span>
<span class="sd">        The name of the file to be read in.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Calling readBasin&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Reading basin file </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">basinNum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basinNum</span><span class="p">):</span>
        <span class="c1"># check start sign and basinNo</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&gt;!Basin&quot;</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error start sign while reading basin file.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error basin number while reading basin file.&quot;</span><span class="p">)</span>

        <span class="n">pointer</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="n">volumeNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pointer</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">transNum</span> <span class="o">=</span> <span class="n">pointer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="ow">or</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
            <span class="n">lineNum</span> <span class="o">=</span> <span class="mi">6</span><span class="o">+</span><span class="mi">19</span><span class="o">*</span><span class="n">volumeNum</span><span class="o">+</span><span class="mi">23</span><span class="o">*</span><span class="n">transNum</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lineNum</span> <span class="o">=</span> <span class="mi">6</span><span class="o">+</span><span class="mi">18</span><span class="o">*</span><span class="n">volumeNum</span><span class="o">+</span><span class="mi">23</span><span class="o">*</span><span class="n">transNum</span>
        <span class="c1"># print lineNum</span>
        <span class="n">newBasin</span> <span class="o">=</span> <span class="n">BasinObject</span><span class="p">(</span><span class="n">KMCRunner</span><span class="p">)</span>
        <span class="n">newBasin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="n">lineNum</span><span class="p">])</span>

        <span class="c1"># check end sign and basinNo</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">lineNum</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&lt;!Basin&quot;</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end sign while reading basin file.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end basin number while reading basin file.&quot;</span><span class="p">)</span>

        <span class="k">del</span> <span class="n">line</span><span class="p">[:</span><span class="n">lineNum</span><span class="p">]</span>
        <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newBasin</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)):</span>
            <span class="c1"># print &quot;*&quot;*30</span>
            <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">printout</span><span class="p">()</span>
            <span class="c1"># print &quot;*&quot;*30</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)):</span>
            <span class="n">basinI</span> <span class="o">=</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;In basin # </span><span class="si">%d</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> volumes&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">basinI</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LKMC 150623-1236-g1254817 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Chris Scott, Tomas Lazauskas, Miao Yu.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>